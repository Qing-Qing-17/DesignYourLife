<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ‰¾åˆ°å±¬æ–¼ä½ çš„äººç”Ÿåƒ¹å€¼ï½œäººç”Ÿä½¿å‘½æ—…ç¨‹éŠæˆ²</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #6b8cff 0, #1c1b3f 40%, #040014 100%);
      color: #f8f4ff;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }

    .container {
      width: 100%;
      max-width: 900px;
      min-height: 80vh;
      background: rgba(10, 8, 35, 0.9);
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    h1, h2, h3 {
      margin-bottom: 12px;
      letter-spacing: 0.04em;
    }

    h1 {
      font-size: 1.8rem;
    }

    h2 {
      font-size: 1.4rem;
    }

    p {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    .screen {
      display: none;
      height: 100%;
    }

    .screen.active {
      display: block;
    }

    .field-group {
      margin-bottom: 12px;
    }

    label {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 4px;
      opacity: 0.9;
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(12, 10, 40, 0.9);
      color: #f8f4ff;
      font-size: 0.9rem;
      resize: vertical;
    }

    textarea {
      min-height: 80px;
    }

    .radio-group,
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      margin-top: 4px;
    }

    .radio-group label,
    .checkbox-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.85rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.05);
      cursor: pointer;
    }

    .checkbox-pill input {
      accent-color: #f5ce6a;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #f5ce6a, #ff9f6a);
      color: #2a1b38;
      font-weight: 600;
      font-size: 0.95rem;
      margin-top: 12px;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.15s;
    }

    .btn.secondary {
      background: rgba(255, 255, 255, 0.05);
      color: #f8f4ff;
      box-shadow: none;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.5);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
      opacity: 0.9;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .section-title {
      font-size: 1rem;
      margin: 10px 0 4px;
      font-weight: 600;
      color: #f5ce6a;
    }

    .small-text {
      font-size: 0.8rem;
      opacity: 0.75;
    }

    .tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      font-size: 0.78rem;
    }

    .tag {
      border-radius: 999px;
      padding: 2px 8px;
      background: rgba(245, 206, 106, 0.08);
      border: 1px solid rgba(245, 206, 106, 0.35);
      color: #f5ce6a;
    }

    .setup-columns {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }

    .card {
      border-radius: 14px;
      padding: 10px 12px;
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.05), rgba(8, 6, 28, 0.9));
      border: 1px solid rgba(255, 255, 255, 0.12);
      min-height: 140px;
    }

    .counter-text {
      font-size: 0.8rem;
      margin-top: 4px;
      opacity: 0.8;
    }

    /* Journey screen */
    .journey-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .progress-text {
      font-size: 0.82rem;
      opacity: 0.85;
    }

    .timer {
      font-size: 0.9rem;
      font-weight: 600;
      color: #f5ce6a;
    }

    .timer span {
      font-size: 1.1rem;
    }

    .question-card {
      margin-top: 6px;
      border-radius: 16px;
      padding: 14px;
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.06), rgba(15, 8, 40, 0.96));
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .question-title {
      font-size: 1.1rem;
      margin-bottom: 6px;
      color: #f5ce6a;
    }

    .question-desc {
      font-size: 0.92rem;
      margin-bottom: 10px;
    }

    .choices {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: 6px;
    }

    @media (min-width: 640px) {
      .choices {
        grid-template-columns: 1fr 1fr;
      }
    }

    .choice-btn {
      width: 100%;
      justify-content: flex-start;
      text-align: left;
      white-space: normal;
      line-height: 1.4;
    }

    .mini-log {
      margin-top: 10px;
      font-size: 0.78rem;
      opacity: 0.75;
      max-height: 90px;
      overflow-y: auto;
    }

    .mini-log p {
      margin-bottom: 4px;
    }

    /* Modal */
    .modal {
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.65), rgba(16, 10, 52, 0.95));
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
      z-index: 20;
    }

    .modal.hidden {
      display: none;
    }

    .modal-content {
      max-width: 520px;
      width: 100%;
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.06), rgba(7, 4, 30, 0.98));
      border-radius: 18px;
      padding: 16px 16px 14px;
      border: 1px solid rgba(245, 206, 106, 0.4);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.7);
    }

    .modal-title {
      font-size: 1.2rem;
      margin-bottom: 6px;
      color: #f5ce6a;
    }

    .modal-desc {
      font-size: 0.9rem;
      margin-bottom: 10px;
    }

    .modal-options {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-bottom: 8px;
    }

    .divider {
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.4), transparent);
      margin: 10px 0;
    }

    /* Reflection & Summary */
    .reflection-textarea {
      margin-top: 8px;
    }

    .summary-section {
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.035);
      font-size: 0.86rem;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .summary-section h3 {
      font-size: 0.95rem;
      margin-bottom: 4px;
      color: #f5ce6a;
    }

    .summary-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .summary-list span {
      font-size: 0.8rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(245, 206, 106, 0.1);
      border: 1px solid rgba(245, 206, 106, 0.4);
      color: #f5ce6a;
    }

    .summary-log {
      max-height: 120px;
      overflow-y: auto;
      font-size: 0.78rem;
      margin-top: 4px;
    }

    .summary-log p {
      margin-bottom: 4px;
    }

    .starry {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.18) 0, transparent 40%),
        radial-gradient(circle at 80% 10%, rgba(255, 255, 255, 0.12) 0, transparent 50%),
        radial-gradient(circle at 30% 80%, rgba(255, 255, 255, 0.08) 0, transparent 55%);
      opacity: 0.15;
    }

    /* Mission screen */
    .mission-section {
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.03);
    }

    .mission-section h3 {
      font-size: 0.95rem;
      margin-bottom: 6px;
      color: #f5ce6a;
    }

    .mission-subtitle {
      font-size: 0.85rem;
      margin-bottom: 4px;
    }

    .mission-multi-inputs input {
      margin-bottom: 6px;
    }

    #radar-canvas {
      width: 100%;
      max-width: 420px;
      margin-top: 8px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    /* å ±å‘Šæ›¸æ’ç‰ˆ */
    .report-card {
      border-radius: 18px;
      padding: 14px 16px 16px;
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.06), rgba(6, 2, 24, 0.96));
      border: 1px solid rgba(245, 206, 106, 0.5);
      box-shadow: 0 16px 36px rgba(0, 0, 0, 0.7);
      max-height: 72vh;
      overflow-y: auto;
    }

    .report-header {
      text-align: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px dashed rgba(245, 206, 106, 0.5);
    }

    .report-title {
      font-size: 1.4rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .report-subtitle {
      font-size: 0.86rem;
      opacity: 0.85;
    }

    .report-meta {
      margin-top: 4px;
      font-size: 0.8rem;
      opacity: 0.75;
    }

    .report-section {
      margin-top: 10px;
    }

    .report-section h3 {
      font-size: 0.98rem;
      margin-bottom: 4px;
      color: #f5ce6a;
    }

    .report-caption {
      font-size: 0.82rem;
      opacity: 0.8;
      margin-bottom: 4px;
    }

    .report-footer {
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px dashed rgba(245, 206, 106, 0.5);
      font-size: 0.8rem;
      opacity: 0.85;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="starry"></div>

    <!-- Start Screen -->
    <div id="start-screen" class="screen active">
      <h1>æ‰¾åˆ°å±¬æ–¼ä½ çš„äººç”Ÿåƒ¹å€¼</h1>
      <p class="small-text">
        å¾ 18 æ­²å‡ºç™¼ï¼Œè¸ä¸Šä¸€æ¢åªå±¬æ–¼ä½ çš„ç”Ÿå‘½é“è·¯ã€‚<br />
        é€éé¸æ“‡ã€å¤±å»èˆ‡ç²å¾—ï¼Œä½ æœƒæ…¢æ…¢çœ‹è¦‹ï¼š<br />
        ã€Œæˆ‘ç‚ºä»€éº¼è€Œå­˜åœ¨ï¼Ÿæˆ‘æƒ³æˆç‚ºæ€æ¨£çš„å¤§äººï¼Ÿã€ 
      </p>

      <div class="field-group" style="margin-top: 12px;">
        <label for="player-name">ä½ çš„åå­—æˆ–ç¶½è™Ÿ</label>
        <input id="player-name" type="text" placeholder="ä¾‹å¦‚ï¼šå°æ™´ / æ˜Ÿæ—…äºº" />
      </div>

      <div class="field-group">
        <label>æ€§åˆ¥</label>
        <div class="radio-group">
          <label><input type="radio" name="gender" value="å¥³" /> å¥³</label>
          <label><input type="radio" name="gender" value="ç”·" /> ç”·</label>
          <label><input type="radio" name="gender" value="ä¸æ–¹ä¾¿é€éœ²" /> ä¸æ–¹ä¾¿é€éœ²</label>
        </div>
      </div>

      <div class="field-group">
        <label for="declaration">å‡ºç™¼å‰çš„ç”Ÿå‘½å®£è¨€</label>
        <textarea id="declaration" placeholder="å¯«ä¸‹ä¸€å¥æ­¤åˆ»å°è‡ªå·±æˆ–äººç”Ÿçš„æ‰¿è«¾ï¼Œä¾‹å¦‚ï¼šæˆ‘é¡˜æ„èª å¯¦é¢å°è‡ªå·±çš„å¿ƒã€‚"></textarea>
      </div>

      <button id="btn-start" class="btn">é–‹å§‹æ—…ç¨‹ âœ¨</button>
    </div>

    <!-- Setup Screen -->
    <div id="setup-screen" class="screen">
      <h2>å‡ºç™¼å‰çš„æº–å‚™</h2>
      <p class="small-text">
        åœ¨ 18 æ­²ä»¥å‰ï¼Œä½ å·²ç¶“æ“æœ‰ä¸€äº›èƒ½åŠ›ã€ä¿¡å¿µèˆ‡é™ªä½ èµ°ä¸€æ®µè·¯çš„äººã€‚<br />
        è«‹ç‚ºè‡ªå·±é¸æ“‡ï¼š<strong>3 å€‹èƒ½åŠ›ã€3 å€‹èµ·é»è§€å¿µã€3 ä½é‡è¦å¤¥ä¼´</strong>ã€‚
      </p>

      <div class="setup-columns">
        <div class="card">
          <div class="section-title">ä¸€ã€é¸æ“‡ä¸‰é …ã€Œèƒ½åŠ›ï¼ˆå·¥å…·ï¼‰ã€</div>
          <p class="small-text">å‹¾é¸ä½ è¦ºå¾—è‡ªå·±æ¯”è¼ƒæœ‰ã€æˆ–å¸Œæœ›å¸¶è‘—ä¸Šè·¯çš„èƒ½åŠ›ã€‚</p>
          <div id="abilities-group" class="checkbox-group"></div>
          <div id="abilities-counter" class="counter-text">å·²é¸æ“‡ï¼š0 / 3</div>
        </div>

        <div class="card">
          <div class="section-title">äºŒã€é¸æ“‡ä¸‰å€‹ã€Œèµ·é»è§€å¿µã€</div>
          <p class="small-text">é€™äº›æ˜¯ä½ ç›®å‰å°äººç”Ÿæ¯”è¼ƒèªåŒçš„åŸºæœ¬æƒ³æ³•ã€‚</p>
          <div id="values-group" class="checkbox-group"></div>
          <div id="values-counter" class="counter-text">å·²é¸æ“‡ï¼š0 / 3</div>
        </div>

        <div class="card">
          <div class="section-title">ä¸‰ã€é¸æ“‡ä¸‰ä½ã€ŒåŒè¡Œå¤¥ä¼´ã€</div>
          <p class="small-text">åœ¨ä½ å¿ƒè£¡ï¼Œèª°æ˜¯é‚£äº›è®“ä½ è¦ºå¾—æ¯”è¼ƒä¸å­¤å–®çš„äººï¼Ÿ</p>
          <div id="companions-group" class="checkbox-group"></div>
          <div id="companions-counter" class="counter-text">å·²é¸æ“‡ï¼š0 / 3</div>
        </div>
      </div>

      <button id="btn-begin-journey" class="btn">è¸ä¸Šäººç”Ÿæ—…ç¨‹ ğŸŒŒ</button>
      <button id="btn-back-start" class="btn secondary">è¿”å›ä¸Šä¸€é </button>
    </div>

    <!-- Journey Screen -->
    <div id="journey-screen" class="screen">
      <div class="journey-header">
        <div>
          <div class="progress-text" id="progress-text">ç¬¬ 1 / 15 é¡Œ</div>
          <div class="small-text" id="player-label"></div>
        </div>
        <div class="timer">å€’æ•¸ <span id="timer-count">20</span> ç§’</div>
      </div>

      <div class="question-card">
        <div id="scenario-title" class="question-title"></div>
        <div id="scenario-desc" class="question-desc"></div>
        <div id="choices-container" class="choices"></div>
      </div>

      <div class="mini-log" id="mini-log"></div>
    </div>

    <!-- Reflection Screen -->
    <div id="reflection-screen" class="screen">
      <h2>ä½¿å‘½å°åœé ç«™</h2>
      <p id="reflection-question"></p>
      <div class="reflection-textarea">
        <textarea id="reflection-answer" placeholder="è«‹æŠŠä½ çœŸå¯¦çš„æƒ³æ³•å¯«ä¸‹ä¾†ï¼Œé€™æœƒæˆç‚ºä½ æ—¥å¾Œèª¿æ•´æ–¹å‘çš„ç·šç´¢ã€‚"></textarea>
      </div>
      <button id="btn-reflection-continue" class="btn">ç¹¼çºŒæ—…ç¨‹ âœ</button>
    </div>

    <!-- Mission Exploration Screen -->
    <div id="mission-screen" class="screen">
      <h2 id="mission-title"></h2>
      <p class="small-text" id="mission-desc"></p>

      <div id="mission-body"></div>

      <button id="btn-mission-continue" class="btn">ç¹¼çºŒæ—…ç¨‹ âœ</button>
    </div>

    <!-- Summary Screen: äººç”Ÿä½¿å‘½å ±å‘Šæ›¸ -->
    <div id="summary-screen" class="screen">
      <div class="report-card">
        <div class="report-header">
          <div class="report-title">ğŸª äººç”Ÿä½¿å‘½å ±å‘Šæ›¸</div>
          <p class="report-subtitle">
            é€™ä¸æ˜¯æˆç¸¾å–®ï¼Œè€Œæ˜¯ä½ ç”¨ä¸€æ¬¡æ¬¡é¸æ“‡ï¼Œå¯«ä¸‹çš„éˆé­‚ç´€éŒ„ã€‚
          </p>
          <p class="report-meta" id="summary-intro"></p>
        </div>

	<div class="report-section">
  		<h3>ğŸ§© 0.ä½ çš„éˆé­‚ç¨±è™Ÿ</h3>
 		 <p class="report-caption">
    		é€™æ˜¯æ ¹æ“šä½ çš„ç‰¹è³ªé›·é”åœ–ï¼Œè‡ªå‹•ç”Ÿæˆçš„ã€Œéˆé­‚è§’è‰²ã€ï¼Œä¸æ˜¯æ¨™ç±¤ï¼Œè€Œæ˜¯ä¸€ç¨®è§€çœ‹è‡ªå·±çš„è§’åº¦ã€‚
  		</p>
  	<div id="summary-archetype-title" class="summary-list"></div>
  	<p id="summary-archetype-subtitle" class="report-caption"></p>
  	<p id="summary-archetype-detail" class="small-text"></p>
	</div>


        <div class="report-section">
          <h3>ğŸŒŸ 1.ä½ åœ¨æ—…ç¨‹ä¸­ã€Œå¬å–šè€Œä¾†çš„åŠ›é‡ã€</h3>
          <p class="report-caption">
            é€™äº›æ˜¯ä½ åœ¨é¸æ“‡ã€è¡Œå‹•èˆ‡å¿ƒæ„ä¹‹ä¸­ï¼Œæ…¢æ…¢èšèµ·ä¾†çš„èƒ½åŠ›ã€é—œä¿‚èˆ‡å…§åœ¨å¯¶ç‰©ã€‚
            å®ƒå€‘æ˜¯ä½ çš„å…‰ï¼Œæ˜¯ä½ é¡˜æœ›çš„æ ¹ï¼Œæ˜¯ä½ å‰é€²æ™‚çœŸæ­£çš„åº•æ°£ã€‚
          </p>
          <div id="summary-gained" class="summary-list"></div>
        </div>

        <div class="report-section">
          <h3>ğŸŒ™ 2.ä½ åœ¨æ—…é€”ä¸­ã€Œæ”¾ä¸‹ã€å¤±å»æˆ–äº¤æ›ã€çš„äº‹ç‰©</h3>
          <p class="report-caption">
            æœ‰äº›æ±è¥¿é›¢ä½ è€Œå»ï¼Œæœ‰äº›å‰‡æ˜¯ä½ è¦ªæ‰‹æ”¾ä¸‹ã€‚é€™äº›ä¸æ˜¯å¤±æ•—ï¼Œè€Œæ˜¯ä½ ç”¨ä¾†äº¤æ›æˆé•·ã€
            æ›æˆæ›´è²¼è¿‘æœ¬å¿ƒé“è·¯çš„ä»£åƒ¹ã€‚
          </p>
          <div id="summary-lost" class="summary-list"></div>
        </div>

        <div class="report-section">
          <h3>ğŸ”¥ 3.æ­¤åˆ»åœ¨ä½ å¿ƒä¸­æœ€æ¸…æ™°çš„ã€Œæ ¸å¿ƒåƒ¹å€¼ã€</h3>
          <p class="report-caption">
            é€™äº›åƒ¹å€¼ä¸æ˜¯ä½ ç¡¬é¸çš„ï¼Œè€Œæ˜¯æ•´è¶Ÿæ—…ç¨‹æ‚„æ‚„æ‹¼æ¹Šå‡ºçš„å¿ƒä¹‹åœ°åœ–ã€‚
            å®ƒå€‘å‘Šè¨´ä½ ï¼šä»€éº¼æ˜¯ä½ é¡˜æ„ç‚ºä¹‹åŠªåŠ›ã€æ‰¿æ“”èˆ‡å®ˆè­·çš„äº‹ã€‚
          </p>
          <div id="summary-core-values" class="summary-list"></div>
        </div>

        <div class="report-section">
          <h3>ğŸŒ± 4.ä½ æ¸´æœ›æˆç‚ºçš„æ¨£å­ï¼ˆäººç”Ÿé¡˜æ™¯ï¼‰</h3>
          <p class="report-caption">
            ä½ å°æœªä¾†çš„ç›´è¦ºï¼Œæ˜¯éˆé­‚æœ€èª å¯¦çš„è²éŸ³ã€‚ä½ å·²ç¶“åœ¨æœè‘—é‚£å€‹ç‰ˆæœ¬çš„è‡ªå·±é è¿‘ã€‚
          </p>
          <div id="summary-vision" class="summary-list"></div>
        </div>

        <div class="report-section">
          <h3>âœ¨ 5.ä½ ç¾åœ¨æœ€éœ€è¦æŠŠæ¡çš„ä¸‰ä»¶äº‹</h3>
          <p class="report-caption">
            æ¯ä¸€æ®µæ—…ç¨‹çš„å°¾è²ï¼Œéƒ½æœƒé‡æ’ä¸€æ¬¡ã€Œæ­¤åˆ»æœ€é‡è¦çš„å„ªå…ˆé †åºã€ã€‚
            ä¸‹é¢é€™å¹¾ä»¶ï¼Œæ˜¯ç¾åœ¨ç‰¹åˆ¥å€¼å¾—ä½ æŠ“ç·Šçš„ç·šç´¢ã€‚
          </p>
          <div id="summary-seize" class="summary-list"></div>
        </div>

        <div class="report-section">
          <h3>ğŸ’« 6.ä½ çš„ä¸‰å¤§éˆé­‚äº®é»ï¼ˆé–ƒå…‰ç‰¹è³ªï¼‰</h3>
          <p class="report-caption">
            é€™ä¸æ˜¯ä½ ã€Œæ‡‰è©²è®Šæˆã€çš„æ¨£å­ï¼Œè€Œæ˜¯ä½ è‡ªç„¶æ•£ç™¼å‡ºä¾†çš„å…‰ã€‚
            å®ƒå€‘æœƒæˆç‚ºä½ é€£çµä¸–ç•Œã€é™ªä¼´ä»–äººã€å¯¦è¸ä½¿å‘½çš„æœ€è‡ªç„¶æ–¹å¼ã€‚
          </p>
          <div id="summary-strengths" class="summary-list"></div>
        </div>

        <div class="report-section">
          <h3>ğŸ§­ 7.ä½ çš„ç‰¹è³ªé›·é”åœ–ï¼ˆç”Ÿå‘½çš„å…«å€‹æ–¹å‘ï¼‰</h3>
          <p class="report-caption">
            é€™å¼µé›·é”åœ–åƒæ˜¯ä¸€å¹…éˆé­‚åœ°è²Œï¼Œå‘ˆç¾ç›®å‰ä½ æ¯”è¼ƒå¸¸ç”¨åŠ›ã€è¼ƒè‡ªç„¶ç™¼å…‰çš„å¹¾å€‹é¢å‘ã€‚
            æ²’æœ‰å¥½å£ï¼Œåªæ˜¯æ­¤åˆ»çš„ä½ é•·æˆçš„æ¨¡æ¨£ã€‚
          </p>
          <canvas id="radar-canvas" width="380" height="280"></canvas>
        </div>

        <div class="report-section">
          <h3>ğŸª 8.æ—…ç¨‹ä¸­çš„ä¸‰æ¬¡éˆé­‚æå•ï¼ˆå…§åœ¨ç¨ç™½ï¼‰</h3>
          <p class="report-caption">
            é€™ä¸‰æ¬¡åœä¸‹è…³æ­¥çš„æ›¸å¯«ï¼Œæ˜¯ä½ å¿ƒåº•æœ€èª å¯¦çš„è²éŸ³ã€‚è¿·æƒ˜çš„æ™‚å€™ï¼Œä¹Ÿè¨±å¯ä»¥å›ä¾†çœ‹çœ‹ã€‚
          </p>
          <div class="btn-row">
            <button id="btn-toggle-reflections" class="btn secondary">æŸ¥çœ‹ï¼æ”¶é—” éˆé­‚æå•</button>
          </div>
          <div id="detail-reflections" class="summary-section" style="display:none; margin-top:8px;">
            <h3>éˆé­‚æå•ç´€éŒ„</h3>
            <p class="small-text">â‘  æ­¤åˆ»ï¼Œæˆ‘æœ€åœ¨ä¹çš„åƒ¹å€¼ï¼š</p>
            <p id="summary-ref1"></p>
            <div class="divider"></div>
            <p class="small-text">â‘¡ æˆ‘æœ€æƒ³ç…§äº®çš„äººèˆ‡æ—ç¾¤ï¼š</p>
            <p id="summary-ref2"></p>
            <div class="divider"></div>
            <p class="small-text">â‘¢ æˆ‘å­˜åœ¨ï¼Œæ˜¯ç‚ºäº†ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼š</p>
            <p id="summary-ref3"></p>
          </div>
        </div>

        <div class="report-section">
          <h3>ğŸ“– ä¹ã€æ—…ç¨‹äº‹ä»¶å‰ªå½±ï¼ˆé¸æ“‡ç´€éŒ„ï¼‰</h3>
          <p class="report-caption">
            é€™äº›ä¸æ˜¯æˆç¸¾ï¼Œè€Œæ˜¯ä½ æ€è€ƒã€çŒ¶è±«ã€å—å‚·ã€å‹‡æ•¢èˆ‡æˆé•·çš„ç—•è·¡ã€‚
          </p>
          <div class="btn-row">
            <button id="btn-toggle-log" class="btn secondary">æŸ¥çœ‹ï¼æ”¶é—” æ—…ç¨‹ç‰‡æ®µ</button>
          </div>
          <div id="detail-log" class="summary-section" style="display:none; margin-top:8px;">
            <h3>æ—…ç¨‹äº‹ä»¶ç´€éŒ„</h3>
            <div id="summary-log" class="summary-log"></div>
          </div>
        </div>

        <div class="summary-section">
          <h3>é‡æ–°å‡ºç™¼çš„é‚€è«‹</h3>
          <p class="report-caption">
            ä½ å·²ç¶“ç”¨ä¸€æ¬¡æ—…ç¨‹ï¼Œæ›åˆ°ä¸€ä»½æ›´èªè­˜è‡ªå·±çš„åœ°åœ–ã€‚  
            å¦‚æœä½ é¡˜æ„ï¼Œå¯ä»¥å¸¶è‘—é€™ä»½å ±å‘Šï¼Œå†èµ°ä¸€è¶Ÿå®Œå…¨ä¸åŒçš„ç‰ˆæœ¬ã€‚
          </p>
          <button id="btn-restart" class="btn">å†èµ°ä¸€è¶Ÿä¸åŒçš„äººç”Ÿ âœ¨</button>
        </div>

        <div class="report-footer">
          ã€Œä½ æ¯”è‡ªå·±æƒ³çš„æ›´æº«æŸ”ï¼Œä¹Ÿæ¯”è‡ªå·±ä»¥ç‚ºçš„æ›´å …å¼·ã€‚ã€  
          <br />â€”â€” æ„Ÿè¬ä½ ï¼Œé¡˜æ„èªçœŸåœ°æ´»ä¸€æ¬¡ã€‚
        </div>
      </div>
    </div>

    <!-- Card Modal (Chance / Fate) -->
    <div id="card-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-title" id="card-title"></div>
        <div class="modal-desc" id="card-description"></div>
        <div id="card-options" class="modal-options"></div>
        <button id="card-close" class="btn" style="display:none;">æ¥å—ä¸¦ç¹¼çºŒ âœ</button>
        <p class="small-text" id="card-footnote"></p>
      </div>
    </div>
  </div>

  <script>
    // =============================
    // Data Definitions
    // =============================
    const abilitiesOptions = [
      "å‚¾è½", "åˆ†æåŠ›", "å‰µæ„", "è¡¨é”èƒ½åŠ›", "é‹å‹•èƒ½åŠ›", "å …æŒåŠ›",
      "è§£æ±ºå•é¡Œ", "è€å¿ƒ", "æƒ³åƒåŠ›", "æŠ€è¡“èƒ½åŠ›ï¼ˆå¯«ç¨‹å¼ã€è¨­è¨ˆï¼‰",
      "è§€å¯ŸåŠ›", "å‹‡æ°£"
    ];

    const valueOptions = [
      "èª å¯¦æ¯”æˆåŠŸé‡è¦",
      "ä¸€å®šè¦å­¸æœƒæ„›äººèˆ‡è¢«æ„›",
      "åŠªåŠ›ä¸ä¸€å®šæˆåŠŸï¼Œä½†ä¸åŠªåŠ›æ›´ä¸æœƒæˆåŠŸ",
      "è¦ç…§é¡§å¥½èº«é«”",
      "æœ‹å‹æ˜¯äººç”Ÿé‡è¦çš„æ”¯æŸ±",
      "å¤±æ•—æ˜¯æˆé•·çš„ä¸€éƒ¨åˆ†",
      "ä¿¡ä»»è¦æ…¢æ…¢å»ºç«‹",
      "ä¸–ç•Œå¾ˆå¤§ï¼Œè¦å¤šæ¢ç´¢",
      "é‡‘éŒ¢é‡è¦ï¼Œä½†ä¸æ˜¯å…¨éƒ¨",
      "å¹«åŠ©åˆ¥äººä¹Ÿæ˜¯æˆå°±è‡ªå·±"
    ];

    const companionOptions = [
      "çˆºçˆºæˆ–å¥¶å¥¶",
      "çˆ¸çˆ¸",
      "åª½åª½",
      "å“¥å“¥ / å§Šå§Š",
      "å¼Ÿå¼Ÿ / å¦¹å¦¹",
      "æœ€çŸ¥å¿ƒçš„å¥½æœ‹å‹",
      "ä¸€ä½å•Ÿç™¼ä½ çš„è€å¸«",
      "ä¸€ä½ç¸½æ˜¯æ”¯æŒä½ çš„å‰è¼©",
      "ä¸€ä½ä½ ç¾åœ¨å¾ˆåœ¨ä¹çš„å°è±¡",
      "ä¸€ä½ç²¾ç¥ / ä¿¡ä»°ä¸Šçš„å°å¸«"
    ];

    // 15 life scenarios
    const scenarios = [
      {
        id: 1,
        title: "è¸å…¥å¤§å­¸çš„ä¸€å¤©ï¼šä½ é¸æ“‡æ€éº¼é–‹å§‹ï¼Ÿ",
        description: "ä½ å‰›æ»¿ 18 æ­²ï¼Œé€²å…¥ä¸€å€‹å…¨æ–°çš„ç’°å¢ƒã€‚é¢å°æœªçŸ¥ï¼Œä½ çš„ç¬¬ä¸€æ­¥æœƒæ˜¯â€”â€”",
        choices: [
          { id: "A", text: "åƒåŠ å¤§é‡ç¤¾åœ˜èªè­˜æ–°æœ‹å‹", effect: "ç²å¾—ï¼šå‹‡æ°£ã€æ–°å¤¥ä¼´" },
          { id: "B", text: "æŠŠæ™‚é–“æ”¾åœ¨èª²æ¥­å’Œè‡ªæˆ‘æå‡", effect: "ç²å¾—ï¼šè‡ªå¾‹ã€å°ˆæ¥­èƒ½åŠ›" },
          { id: "C", text: "è·ŸåŒå­¸ç›¸è™•ï¼Œä¿æŒèˆ’æœçš„æ¯”ç‡", effect: "ç²å¾—ï¼šå¹³è¡¡æ„Ÿ" },
          { id: "D", text: "å…ˆè§€å¯Ÿç’°å¢ƒï¼Œå°æ­¥å‰é€²", effect: "ç²å¾—ï¼šè§€å¯ŸåŠ›" }
        ]
      },
      {
        id: 2,
        title: "ç¬¬ä¸€æ¬¡å¿ƒå‹•ï¼šæœ‰äººå‘ä½ ç¤ºå¥½",
        description: "ä½ é‡åˆ°ä¸€ä½è®“ä½ å¿ƒæš–çš„äººï¼Œä»–/å¥¹å‘ä½ ç¤ºå¥½ã€‚",
        choices: [
          { id: "A", text: "å‹‡æ•¢é–‹å§‹ä¸€æ®µé—œä¿‚", effect: "ç²å¾—ï¼šä¼´ä¾¶å¤¥ä¼´ï¼›ä»˜å‡ºï¼šè‡ªç”±æ™‚é–“" },
          { id: "B", text: "è¡¨ç¤ºéœ€è¦æ™‚é–“è§€å¯Ÿ", effect: "ç²å¾—ï¼šç•Œç·š" },
          { id: "C", text: "å–œæ­¡ä½†å…ˆå°ˆæ³¨èª²æ¥­", effect: "ç²å¾—ï¼šå°ˆæ³¨åŠ›" },
          { id: "D", text: "ç¦®è²Œæ‹’çµ•", effect: "ç²å¾—ï¼šè‡ªæˆ‘å°Šé‡ï¼›å¤±å»ï¼šå¯èƒ½çš„ç·£åˆ†" }
        ]
      },
      {
        id: 3,
        title: "ç¤¾åœ˜èˆ‡èª²æ¥­æ’æœŸï¼Œä½ åªèƒ½é¸ä¸€å€‹",
        description: "é‡è¦ç¤¾åœ˜æ´»å‹•å’ŒæœŸä¸­è€ƒè¤‡ç¿’æ’æœŸï¼Œä½ å¿…é ˆé¸æ“‡ã€‚",
        choices: [
          { id: "A", text: "åƒåŠ ç¤¾åœ˜æ´»å‹•", effect: "ç²å¾—ï¼šäººè„ˆï¼›å¤±å»ï¼šèª²æ¥­æ™‚é–“" },
          { id: "B", text: "å°ˆæ³¨ä¸Šèª²", effect: "ç²å¾—ï¼šçŸ¥è­˜ï¼›å¤±å»ï¼šç¤¾äº¤" },
          { id: "C", text: "é›™ç·šä¸¦è¡Œï¼Œå£“åŠ›å¾ˆå¤§", effect: "ç²å¾—ï¼šè€åŠ›ï¼›å¤±å»ï¼šå¥åº·" },
          { id: "D", text: "æ”¾æ£„å…©è€…ï¼Œé¸æ“‡å¥½å¥½ä¼‘æ¯", effect: "ç²å¾—ï¼šèƒ½é‡ï¼›å¤±å»ï¼šç™¼å±•æ©Ÿæœƒ" }
        ]
      },
      {
        id: 4,
        title: "ä½ ç¬¬ä¸€æ¬¡å’Œå®¶äººæ¿€çƒˆçˆ­åŸ·",
        description: "åŸå› å¯èƒ½æ˜¯åƒ¹å€¼è§€ã€æœ‹å‹ã€ç”Ÿæ´»æ–¹å¼ï¼Œä½ å€‘èªªäº†å¾ˆå¤šé‡è©±ã€‚",
        choices: [
          { id: "A", text: "ä¸»å‹•é“æ­‰ä¿®å¾©é—œä¿‚", effect: "ç²å¾—ï¼šå®¶åº­å¤¥ä¼´ã€æˆç†Ÿ" },
          { id: "B", text: "å†·éœæºé€šï¼ŒæŠŠè©±èªªæ¸…æ¥š", effect: "ç²å¾—ï¼šå°è©±èƒ½åŠ›" },
          { id: "C", text: "é¸æ“‡æ‹‰é–‹è·é›¢ï¼Œä¸æƒ³é¢å°", effect: "å¤±å»ï¼šéƒ¨åˆ†å®¶åº­é€£çµ" },
          { id: "D", text: "æƒ…ç·’åŒ–åæ“Š", effect: "å¤±å»ï¼šä¿¡ä»»ï¼›ç²å¾—ï¼šå¾Œæ‚”" }
        ]
      },
      {
        id: 5,
        title: "é­é‡æ˜é¡¯æŒ«æ•—ï¼šæ¯”è³½è½é¸æˆ–æˆç¸¾ä¸ä½³",
        description: "ä½ å¾ˆåŠªåŠ›ï¼Œçµæœå»ä¸å¦‚é æœŸã€‚",
        choices: [
          { id: "A", text: "é‡æ–°åŠªåŠ›ï¼Œèª¿æ•´æ–¹å¼å†ä¾†", effect: "ç²å¾—ï¼šéŸŒæ€§" },
          { id: "B", text: "è½‰æ›æ–¹å‘ï¼Œå°‹æ‰¾æ›´é©åˆè‡ªå·±çš„è·¯", effect: "ç²å¾—ï¼šå½ˆæ€§" },
          { id: "C", text: "å…ˆåœä¸‹ä¾†ä¼‘æ¯å’Œç™‚å‚·", effect: "ç²å¾—ï¼šè‡ªæˆ‘ç…§é¡§" },
          { id: "D", text: "å£“æŠ‘æƒ…ç·’ï¼Œå‡è£æ²’äº‹", effect: "å¤±å»ï¼šæƒ…ç·’å¥åº·" }
        ]
      },
      {
        id: 6,
        title: "é‡åˆ°ä¸€ä½çœŸæ­£é¡˜æ„æ•™ä½ çš„å‰è¼©æˆ–è€å¸«",
        description: "å°æ–¹çœ‹è¦‹ä½ çš„æ½›åŠ›ï¼Œé¡˜æ„çµ¦ä½ æŒ‡é»ã€‚",
        choices: [
          { id: "A", text: "æŠ“ä½æ©Ÿæœƒï¼Œä¸»å‹•è«‹æ•™èˆ‡å­¸ç¿’", effect: "ç²å¾—ï¼šè²´äººã€æŠ€èƒ½" },
          { id: "B", text: "è¦ºå¾—ä¸å¥½æ„æ€ï¼Œä¸æ•¢å¤ªæ‰“æ“¾", effect: "ç²å¾—ï¼šè¬™è™›ï¼›å¤±å»ï¼šéƒ¨åˆ†æ©Ÿæœƒ" },
          { id: "C", text: "ä¿æŒè‡ªç„¶ä¾†å¾€ï¼Œé †å…¶è‡ªç„¶", effect: "ç²å¾—ï¼šé™ªä¼´æ„Ÿ" },
          { id: "D", text: "è¦ºå¾—è‡ªå·±ä¸å€¼å¾—è¢«æ ½åŸ¹", effect: "å¤±å»ï¼šè‡ªä¿¡" }
        ]
      },
      {
        id: 7,
        title: "èº«é«”äº®èµ·ç´…ç‡ˆï¼Œéœ€è¦èª¿æ•´ç”Ÿæ´»",
        description: "ç†¬å¤œã€å£“åŠ›ã€é£²é£Ÿä¸æ­£å¸¸è®“ä½ èº«é«”ä¸èˆ’æœã€‚",
        choices: [
          { id: "A", text: "é–‹å§‹è¦å¾‹é‹å‹•èˆ‡ä½œæ¯", effect: "ç²å¾—ï¼šå¥åº·ï¼›ä»˜å‡ºï¼šè‡ªç”±æ™‚é–“" },
          { id: "B", text: "å¾é£²é£Ÿæ§åˆ¶é–‹å§‹", effect: "ç²å¾—ï¼šè‡ªå¾‹" },
          { id: "C", text: "è¦ºå¾—æ²’é—œä¿‚ï¼Œæ’ä¸€ä¸‹å°±éäº†", effect: "å¤±å»ï¼šå¥åº·" },
          { id: "D", text: "éåº¦ç„¦æ…®ï¼Œä¸Šç¶²äº‚æŸ¥ä¸€å †è³‡è¨Š", effect: "å¤±å»ï¼šå¿ƒéˆèƒ½é‡" }
        ]
      },
      {
        id: 8,
        title: "ä½ å’Œå¥½å‹ä¹‹é–“å‡ºç¾èª¤æœƒ",
        description: "ä¸€å¥è©±ã€ä¸€å€‹è¡Œç‚ºï¼Œè®“ä½ å€‘å¿ƒè£¡éƒ½æœ‰äº†ç–™ç˜©ã€‚",
        choices: [
          { id: "A", text: "ä¸»å‹•ç´„å‡ºä¾†å¥½å¥½è«‡", effect: "ç²å¾—ï¼šå‹æƒ…å¤¥ä¼´ã€ä¿¡ä»»" },
          { id: "B", text: "ç­‰å°æ–¹å…ˆä¾†æ‰¾ä½ ", effect: "ç²å¾—ï¼šè€å¿ƒ" },
          { id: "C", text: "ä¿æŒè·é›¢ï¼Œè®“é—œä¿‚æ·¡æ‰", effect: "å¤±å»ï¼šé—œä¿‚ï¼›ç²å¾—ï¼šå®‰å…¨æ„Ÿ" },
          { id: "D", text: "ç›´æ¥å°é–ï¼Œå‡è£å°æ–¹ä¸å­˜åœ¨", effect: "å¤±å»ï¼šé‡è¦å¤¥ä¼´ï¼›ç²å¾—ï¼šå†·æ„Ÿ" }
        ]
      },
      {
        id: 9,
        title: "ä½ æ”¶åˆ°ä¸€ä»½ä¸éŒ¯çš„æ‰“å·¥ï¼å¯¦ç¿’æ©Ÿæœƒï¼Œä½†æœƒå¾ˆå¿™",
        description: "é€™å€‹æ©Ÿæœƒå¯èƒ½æœƒæ”¹è®Šä½ çš„å±¥æ­·ï¼Œä¹Ÿå¯èƒ½å£“å®ä½ çš„ç”Ÿæ´»å¹³è¡¡ã€‚",
        choices: [
          { id: "A", text: "æ¥ä¸‹æŒ‘æˆ°ï¼Œçœ‹çœ‹è‡ªå·±èƒ½èµ°å¤šé ", effect: "ç²å¾—ï¼šèƒ½åŠ›ï¼›ä»˜å‡ºï¼šä¼‘æ¯" },
          { id: "B", text: "æ¨è–¦çµ¦æ›´é©åˆçš„æœ‹å‹", effect: "ç²å¾—ï¼šå–„è‰¯" },
          { id: "C", text: "å©‰æ‹’ï¼Œç¶­æŒç¾åœ¨çš„ç¯€å¥", effect: "ç²å¾—ï¼šå¹³è¡¡" },
          { id: "D", text: "çŒ¶è±«å¤ªä¹…ï¼Œæ©Ÿæœƒè‡ªå‹•æ¶ˆå¤±", effect: "å¤±å»ï¼šæ©Ÿæœƒ" }
        ]
      },
      {
        id: 10,
        title: "ç¬¬ä¸€æ¬¡é¢å°å¤±æˆ€æˆ–ä¸€æ®µæ·±åˆ»çš„é›¢é–‹",
        description: "é€™æ®µé—œä¿‚å°ä½ å¾ˆé‡è¦ï¼Œä½†èµ°åˆ°äº†çµ‚é»ã€‚",
        choices: [
          { id: "A", text: "å¥½å¥½å“­ä¸€å ´ï¼Œç„¶å¾Œæ…¢æ…¢ç«™èµ·ä¾†", effect: "ç²å¾—ï¼šéŸŒæ€§" },
          { id: "B", text: "å•è‡ªå·±ï¼šé€™æ®µæ„Ÿæƒ…æ•™æœƒäº†æˆ‘ä»€éº¼ï¼Ÿ", effect: "ç²å¾—ï¼šæ™ºæ…§" },
          { id: "C", text: "å°é–‰å¿ƒé–€ï¼Œä¸å†è¼•æ˜“æŠ•å…¥æ„Ÿæƒ…", effect: "å¤±å»ï¼šä¿¡ä»»" },
          { id: "D", text: "æ€¥è‘—æ‰¾ä¸‹ä¸€å€‹äººå¡«è£œç©ºç¼º", effect: "å¤±å»ï¼šè‡ªæˆ‘åŠ›é‡" }
        ]
      },
      {
        id: 11,
        title: "ä½ ç²å¾—å‡ºåœ‹äº¤æ›æˆ–å¤§å‹è¨ˆç•«çš„é‚€è«‹",
        description: "é€™æ˜¯ä¸€å€‹çœ‹è¦‹æ›´å¤§ä¸–ç•Œçš„æ©Ÿæœƒï¼Œä¹Ÿä¼´éš¨é¢¨éšªèˆ‡æˆæœ¬ã€‚",
        choices: [
          { id: "A", text: "å‹‡æ•¢å‡ºç™¼ï¼Œé¸æ“‡é£›å‡ºå»", effect: "ç²å¾—ï¼šè¦–é‡ï¼›ä»˜å‡ºï¼šé‡‘éŒ¢" },
          { id: "B", text: "è¦ºå¾—é‚„æ²’æº–å‚™å¥½ï¼Œå…ˆæ”¾æ£„", effect: "ç²å¾—ï¼šè¬¹æ…" },
          { id: "C", text: "å› å®¶åº­éœ€è¦è€Œç•™åœ¨åŸåœ°", effect: "ç²å¾—ï¼šè²¬ä»»æ„Ÿï¼›å¤±å»ï¼šæˆé•·æ©Ÿæœƒ" },
          { id: "D", text: "ä¸€ç›´çŒ¶è±«ï¼Œæœ€å¾Œè¶…éæœŸé™", effect: "å¤±å»ï¼šå‹‡æ°£" }
        ]
      },
      {
        id: 12,
        title: "é‡åˆ°ä¸€å€‹éå¸¸é›£ç›¸è™•çš„åŒå­¸æˆ–åŒäº‹",
        description: "ä½ å€‘å¸¸æœ‰æ‘©æ“¦ï¼Œå»å¿…é ˆå…±äº‹ã€‚",
        choices: [
          { id: "A", text: "è©¦è‘—ç†è§£ä»–çš„ç«‹å ´ï¼Œç·´ç¿’åŒ…å®¹", effect: "ç²å¾—ï¼šåŒç†å¿ƒ" },
          { id: "B", text: "è¨­ç«‹æ¸…æ¥šç•Œç·šï¼Œä¿è­·è‡ªå·±", effect: "ç²å¾—ï¼šç•Œç·š" },
          { id: "C", text: "ç›´æ¥æ­£é¢è¡çªï¼Œæ”¤ç‰Œè¬›æ¸…æ¥š", effect: "å¤±å»ï¼šéƒ¨åˆ†é—œä¿‚ï¼›ç²å¾—ï¼šå¦ç™½" },
          { id: "D", text: "é¸æ“‡é€ƒé¿ï¼Œèƒ½ä¸åˆä½œå°±ä¸åˆä½œ", effect: "å¤±å»ï¼šæˆç†Ÿåº¦" }
        ]
      },
      {
        id: 13,
        title: "ä½ åšå‡ºä¸€ä»¶çœŸæ­£è®“è‡ªå·±é©•å‚²çš„äº‹",
        description: "å®Œæˆäº†ä¸€å€‹ä½œå“ã€è¨ˆç•«ã€æ¼”è¬›ã€æ¯”è³½æˆ–å…¬ç›Šè¡Œå‹•ã€‚",
        choices: [
          { id: "A", text: "åˆ†äº«çµ¦èº«é‚Šçš„äººï¼Œä¸€èµ·é–‹å¿ƒ", effect: "ç²å¾—ï¼šè‡ªä¿¡ã€äººè„ˆ" },
          { id: "B", text: "æŠŠæˆå°±è—åœ¨å¿ƒè£¡ï¼Œéœéœæ”¶è—", effect: "ç²å¾—ï¼šè¬™å’Œ" },
          { id: "C", text: "ä»¥æ­¤ç‚ºèµ·é»ï¼Œè¨­å®šæ›´å¤§çš„ç›®æ¨™", effect: "ç²å¾—ï¼šå‹•åŠ›" },
          { id: "D", text: "éåº¦è†¨è„¹ï¼Œçœ‹ä¸èµ·åˆ¥äººçš„åŠªåŠ›", effect: "å¤±å»ï¼šè¬™éœ" }
        ]
      },
      {
        id: 14,
        title: "å®¶äººé‡åˆ°å›°é›£ï¼Œä½ éœ€è¦åšé¸æ“‡",
        description: "å¯èƒ½æ˜¯ç–¾ç—…ã€è²¡å‹™ã€æƒ…ç·’æˆ–å…¶ä»–å£“åŠ›ã€‚",
        choices: [
          { id: "A", text: "ç›¡åŠ›ä¼¸å‡ºæ‰‹å”åŠ©", effect: "ç²å¾—ï¼šè²¬ä»»ï¼›ä»˜å‡ºï¼šè³‡æº" },
          { id: "B", text: "é™ªä¼´èˆ‡å‚¾è½ï¼Œä½†è®“ä»–å€‘è‡ªå·±åšæ±ºå®š", effect: "ç²å¾—ï¼šæ™ºæ…§" },
          { id: "C", text: "ä¿æŒè·é›¢ï¼Œå„ªå…ˆç…§é¡§è‡ªå·±çš„ç”Ÿæ´»", effect: "ç²å¾—ï¼šç•Œç·šï¼›å¤±å»ï¼šéƒ¨åˆ†è¦ªæƒ…æ„Ÿ" },
          { id: "D", text: "åˆ»æ„å¿½ç•¥ï¼Œå‡è£ä¸çŸ¥é“", effect: "å¤±å»ï¼šæˆé•·" }
        ]
      },
      {
        id: 15,
        title: "äººç”Ÿåå­—è·¯å£ï¼šå·¥ä½œï¼æ„Ÿæƒ…ï¼æ–¹å‘",
        description: "ä½ ä¾†åˆ°ä¸€å€‹å¿…é ˆé¸æ“‡æœªä¾†æ–¹å‘çš„é—œéµé»ã€‚",
        choices: [
          { id: "A", text: "é¸æ“‡ä¸€æ¢ç›¸å°å®‰ç©©çš„é“è·¯", effect: "ç²å¾—ï¼šç©©å®š" },
          { id: "B", text: "é¸æ“‡çœŸæ­£ç†±æ„›çš„æ–¹å‘", effect: "ç²å¾—ï¼šç†±æƒ…ï¼›ä»˜å‡ºï¼šå®‰å…¨æ„Ÿ" },
          { id: "C", text: "æš«åœä¸€å¹´ï¼Œçµ¦è‡ªå·±æ™‚é–“æ¢ç´¢", effect: "ç²å¾—ï¼šæ¸…æ™°ï¼›ä»˜å‡ºï¼šé‡‘éŒ¢" },
          { id: "D", text: "äº¤çµ¦å®¶äººæ±ºå®šæœªä¾†", effect: "å¤±å»ï¼šè‡ªä¸»ï¼›ç²å¾—ï¼šå®‰å…¨" }
        ]
      }
    ];

    // æ©Ÿæœƒå¡
    const chanceCards = [
      {
        title: "é‡æ–°å‡ºç™¼çš„å‹‡æ°£",
        description: "ä½ å¾—åˆ°ä¸€æ¬¡æ•´ç†äººç”Ÿç‹€æ…‹çš„æ©Ÿæœƒã€‚",
        options: [
          { text: "æ•´ç†å…§å¿ƒï¼Œæ”¾ä¸‹ä¸€å€‹è®“ä½ ç³¾çµå¾ˆä¹…çš„éºæ†¾", effect: "ç²å¾—ï¼šå¿ƒéˆç©ºé–“ï¼›æ”¾ä¸‹ï¼šç³¾çµçš„éºæ†¾" },
          { text: "é‡æ–°è¯çµ¡ä¸€ä½ä½ æƒ³å¿µçš„äºº", effect: "ç²å¾—ï¼šé—œä¿‚ä¿®å¾©" },
          { text: "æ–·æ¨é›¢ä¸€ä»¶è€—æä½ èƒ½é‡çš„äº‹æƒ…", effect: "ç²å¾—ï¼šèƒ½é‡ï¼›æ”¾ä¸‹ï¼šä¸€é …è² æ“”" }
        ]
      },
      {
        title: "æ„å¤–çš„è²´äºº",
        description: "åœ¨ä¸€å ´æ´»å‹•ä¸­ï¼Œæœ‰äººè¢«ä½ çš„çœŸèª æ‰“å‹•ï¼Œé¡˜æ„å¹«åŠ©ä½ ã€‚",
        options: [
          { text: "è«‹ä»–æŒ‡å°ä½ çš„è·æ¶¯æ–¹å‘", effect: "ç²å¾—ï¼šè·æ¶¯æŒ‡å¼•" },
          { text: "è«‹ä»–çµ¦ä½ ç”Ÿæ´»èˆ‡å¿ƒæ…‹å»ºè­°", effect: "ç²å¾—ï¼šå¿ƒéˆæ”¯æŒ" },
          { text: "ç¶­æŒæ™®é€šé—œä¿‚ï¼Œé †å…¶è‡ªç„¶", effect: "ç²å¾—ï¼šç©©å®š" }
        ]
      },
      {
        title: "ä¸€ç­†æ™‚é–“ç´…åˆ©",
        description: "çªç„¶æœ‰ä¸€æ®µç©ºæª”ï¼Œä¸å¿…æ‰“å·¥ã€æ²’æœ‰è€ƒè©¦ã€‚",
        options: [
          { text: "å…¨åŠ›æŠ•å…¥ä¸€å€‹ä½ ä¸€ç›´æƒ³åšçš„è¨ˆç•«", effect: "ç²å¾—ï¼šä½œå“èˆ‡æˆå°±æ„Ÿ" },
          { text: "ç”¨ä¾†é™ªä¼´é‡è¦çš„äºº", effect: "ç²å¾—ï¼šé—œä¿‚æ·±åº¦" },
          { text: "ç”¨ä¾†æ”¾ç©ºèˆ‡å……é›»", effect: "ç²å¾—ï¼šå…§åœ¨ç©©å®š" }
        ]
      },
      {
        title: "éˆæ„Ÿå¤§çˆ†ç™¼",
        description: "ä½ çš„è…¦æµ·è£¡çªç„¶å……æ»¿é»å­ã€‚",
        options: [
          { text: "æŠŠé»å­è¨˜éŒ„ä¸‹ä¾†ï¼Œåšæˆæœªä¾†è¨ˆç•«æ¸…å–®", effect: "ç²å¾—ï¼šå‰µæ„è³‡ç”¢" },
          { text: "é¸ä¸€å€‹æœ€å¯è¡Œçš„ï¼Œç«‹åˆ»é–‹å§‹åŸ·è¡Œ", effect: "ç²å¾—ï¼šè¡Œå‹•åŠ›" },
          { text: "åˆ†äº«çµ¦æœ‹å‹ï¼Œä¸€èµ·è¨è«–å¯èƒ½æ€§", effect: "ç²å¾—ï¼šåˆä½œæ©Ÿæœƒ" }
        ]
      },
      {
        title: "ä¿®å¾©é—œä¿‚çš„çª—å£",
        description: "ä½ å’ŒæŸå€‹ç–é çš„äººä¹‹é–“ï¼Œå‡ºç¾ä¸€å€‹å¯ä»¥å¥½å¥½èªªè©±çš„æ©Ÿæœƒã€‚",
        options: [
          { text: "çœŸèª é“æ­‰èˆ‡è¡¨é”æ„Ÿå—", effect: "ç²å¾—ï¼šé—œä¿‚ä¿®å¾©ã€èª å¯¦" },
          { text: "å°ˆå¿ƒè½å°æ–¹èªªå®Œä»–çš„æ•…äº‹", effect: "ç²å¾—ï¼šåŒç†å¿ƒ" },
          { text: "é¸æ“‡ç¥ç¦ï¼Œè®“é—œä¿‚åœç•™åœ¨é é çš„å–„æ„", effect: "ç²å¾—ï¼šæ”¾ä¸‹" }
        ]
      },
      {
        title: "å­¸ç¿’æ–°æŠ€èƒ½çš„é‚€è«‹",
        description: "æœ‰äººæªä½ ä¸€èµ·å»ä¸Šèª²ã€å·¥ä½œåŠæˆ–ç·šä¸Šèª²ç¨‹ã€‚",
        options: [
          { text: "å­¸ä¸€å€‹å’Œæœªä¾†è·æ¶¯æœ‰é—œçš„æŠ€èƒ½", effect: "ç²å¾—ï¼šå°ˆæ¥­èƒ½åŠ›" },
          { text: "å­¸ä¸€å€‹è®“ç”Ÿæ´»æ›´æœ‰è¶£çš„èˆˆè¶£", effect: "ç²å¾—ï¼šç”Ÿæ´»è±å¯Œåº¦" },
          { text: "è¬çµ•é‚€è«‹ï¼Œæ”¹æˆè‡ªå­¸èˆ‡é–±è®€", effect: "ç²å¾—ï¼šè‡ªå­¸ç¿’æ…£" }
        ]
      },
      {
        title: "è²¡å‹™å°å¥‡è¹Ÿ",
        description: "ä½ æ„å¤–ç²å¾—ä¸€ç­†å°çé‡‘æˆ–ç´…åŒ…ã€‚",
        options: [
          { text: "å­˜èµ·ä¾†ç•¶æœªä¾†çš„å®‰å…¨å¢Š", effect: "ç²å¾—ï¼šå®‰å…¨æ„Ÿ" },
          { text: "æŠ•è³‡åœ¨å­¸ç¿’æˆ–è¨­å‚™", effect: "ç²å¾—ï¼šæœªä¾†è³‡æœ¬" },
          { text: "è«‹èº«é‚Šé‡è¦çš„äººåƒé£¯", effect: "ç²å¾—ï¼šæ„Ÿæƒ…æº«åº¦" }
        ]
      },
      {
        title: "å…¬é–‹ç™¼è²çš„æ©Ÿæœƒ",
        description: "ä½ è¢«é‚€è«‹åœ¨ä¸€å€‹å ´åˆåˆ†äº«ä½ çš„æ•…äº‹æˆ–è§€é»ã€‚",
        options: [
          { text: "å‹‡æ•¢åˆ†äº«çœŸå¯¦çš„è‡ªå·±", effect: "ç²å¾—ï¼šè‡ªä¿¡èˆ‡å½±éŸ¿åŠ›" },
          { text: "è¬¹æ…æº–å‚™ï¼Œåˆ†äº«éƒ¨åˆ†å…§å®¹", effect: "ç²å¾—ï¼šç©©å¥" },
          { text: "å©‰æ‹’ï¼Œé¸æ“‡åœ¨å°åœˆåœˆè£¡äº¤æµ", effect: "ç²å¾—ï¼šå®‰å…¨ï¼›å¤±å»ï¼šæ›å…‰" }
        ]
      },
      {
        title: "è‡ªæˆ‘è¦ºå¯Ÿæ™‚åˆ»",
        description: "æœ‰ä¸€å¥è©±ã€ä¸€æ®µå…§å®¹æ·±æ·±æ‰“åˆ°ä½ ã€‚",
        options: [
          { text: "å¯«ä¸‹é•·ç¯‡æ—¥è¨˜ï¼Œå¥½å¥½å°è©±è‡ªå·±", effect: "ç²å¾—ï¼šè‡ªæˆ‘ç†è§£" },
          { text: "æ‰¾ä¸€å€‹å¯ä¿¡ä»»çš„äººåˆ†äº«æ„Ÿå—", effect: "ç²å¾—ï¼šæƒ…æ„Ÿé€£çµ" },
          { text: "æŠŠé€™ä»½è§¸å‹•è®Šæˆä¸€å€‹å°è¡Œå‹•", effect: "ç²å¾—ï¼šè¡Œå‹•æ•´åˆåŠ›" }
        ]
      },
      {
        title: "äººç”Ÿåœ°åœ–æª¢æŸ¥é»",
        description: "ä½ æš«åœè…³æ­¥ï¼Œé‡æ–°æª¢è¦–ç›®å‰çš„äººç”Ÿè·¯ç·šã€‚",
        options: [
          { text: "èª¿æ•´ä¸€å€‹ä½ è¦ºå¾—åé›¢åˆè¡·çš„åœ°æ–¹", effect: "ç²å¾—ï¼šå°é½Šåˆå¿ƒ" },
          { text: "ç¢ºèªç›®å‰çš„æ–¹å‘ä¸¦åŠ æ·±æ‰¿è«¾", effect: "ç²å¾—ï¼šæ±ºå¿ƒ" },
          { text: "å…è¨±è‡ªå·±å…ˆä¸ç¢ºå®šï¼Œåªæ˜¯èª å¯¦é¢å°è¿·æƒ˜", effect: "ç²å¾—ï¼šå°è‡ªå·±èª å¯¦" }
        ]
      }
    ];

    // å‘½é‹å¡
    const fateCards = [
      {
        title: "çªå¦‚å…¶ä¾†çš„ç”Ÿç—…",
        description: "ä½ çš„èº«é«”å¼·è¿«ä½ æŒ‰ä¸‹æš«åœéµã€‚",
        outcomes: [
          "å¤±å»ä¸€äº›è¡Œç¨‹å®‰æ’ï¼Œä½†æ›ä¾†æ›´å¤šä¼‘æ¯æ™‚é–“èˆ‡åæ€ç©ºé–“ã€‚ç²å¾—ï¼šå¥åº·è¦ºå¯Ÿã€‚"
        ]
      },
      {
        title: "é‡è¦è¨ˆç•«è¢«å–æ¶ˆ",
        description: "ä½ å¾ˆæœŸå¾…çš„ä¸€å€‹æ´»å‹•æˆ–æ©Ÿæœƒçªç„¶è¢«å–æ¶ˆã€‚",
        outcomes: [
          "å¤±å»ä¸€å€‹å±•ç¾è‡ªå·±çš„èˆå°ï¼Œä½†å¤šäº†ä¸€æ®µè‡ªç”±æ™‚é–“å¯ä»¥é‹ç”¨ã€‚"
        ]
      },
      {
        title: "å®¶ä¸­ç™¼ç”Ÿè®Šæ•…",
        description: "å®¶äººéœ€è¦ä½ æ›´å¤šçš„é—œæ³¨èˆ‡é™ªä¼´ã€‚",
        outcomes: [
          "è¢«è¿«èª¿æ•´åŸæœ¬è¨ˆç•«ï¼Œå¤šäº†ä¸€ä»½è²¬ä»»ï¼Œä¹Ÿå¤šäº†ä¸€ä»½æˆç†Ÿã€‚"
        ]
      },
      {
        title: "å‹æƒ…çš„é›¢æ•£",
        description: "ä¸€æ®µä½ ä»¥ç‚ºæœƒä¸€ç›´å­˜åœ¨çš„å‹æƒ…èµ°åˆ°äº†ç›¡é ­ã€‚",
        outcomes: [
          "å¤±å»ä¸€ä½å¤¥ä¼´ï¼Œä½†æ…¢æ…¢å­¸æœƒçæƒœé‚„ç•™åœ¨èº«é‚Šçš„äººã€‚"
        ]
      },
      {
        title: "æƒ…æ„Ÿä¸Šçš„èƒŒå›",
        description: "ä½ åœ¨é—œä¿‚è£¡æ„Ÿå—åˆ°å¼·çƒˆçš„å‚·å®³ã€‚",
        outcomes: [
          "ä¿¡ä»»å—æï¼Œä½†ä¹Ÿé–‹å§‹å­¸æœƒç‚ºè‡ªå·±è¨­ç«‹ç•Œç·šã€‚"
        ]
      },
      {
        title: "éŒ¯å¤±é—œéµæ™‚æ©Ÿ",
        description: "ä½ æ²’æœ‰åœ¨é»ƒé‡‘æ™‚é–“åšå‡ºè¡Œå‹•ã€‚",
        outcomes: [
          "å°‘äº†ä¸€æ¬¡å¤§èºé€²çš„æ©Ÿæœƒï¼Œå»ä¹Ÿè®“ä½ çœ‹æ¸…è‡ªå·±å®³æ€•çš„æ˜¯ä»€éº¼ã€‚"
        ]
      },
      {
        title: "æ„å¤–çš„è²¬ä»»",
        description: "ä½ çªç„¶éœ€è¦ç…§é¡§æŸä»¶äº‹æˆ–æŸå€‹äººã€‚",
        outcomes: [
          "å£“åŠ›å¢åŠ ï¼Œä½†ä¹Ÿè®“ä½ çœ‹è¦‹è‡ªå·±å…¶å¯¦æ¯”æƒ³åƒä¸­æ›´å …å¼·ã€‚"
        ]
      },
      {
        title: "å¤–åœ¨ç’°å¢ƒåŠ‡è®Š",
        description: "ä¾‹å¦‚ç–«æƒ…ã€ç¶“æ¿Ÿè®Šå‹•ï¼Œè®“åŸæœ¬çš„è¨ˆç•«å…¨éƒ¨æ‰“äº‚ã€‚",
        outcomes: [
          "è¢«è¿«ä¿®æ”¹äººç”Ÿè—åœ–ï¼Œå»è®“ä½ ç™¼ç¾æ–°çš„å¯èƒ½æ–¹å‘ã€‚"
        ]
      },
      {
        title: "è¢«èª¤è§£èˆ‡æ‰¹è©•",
        description: "ä½ åšçš„äº‹æƒ…è¢«äººèª¤è§£ï¼Œç”šè‡³å—åˆ°æ‰¹è©•ã€‚",
        outcomes: [
          "å¿ƒè£¡å—å‚·ï¼Œä½†é–‹å§‹å­¸ç¿’åˆ†è¾¨å“ªäº›è²éŸ³å€¼å¾—æ”¾åœ¨å¿ƒä¸Šã€‚"
        ]
      },
      {
        title: "èˆ‡é‡è¦ä¹‹äººçš„æ°¸åˆ¥",
        description: "æŸä½å°ä½ å¾ˆé‡è¦çš„äººé›¢ä¸–æˆ–æ°¸ä¹…é›¢é–‹ä½ çš„ç”Ÿæ´»ã€‚",
        outcomes: [
          "å¤±å»å¯¦éš›çš„é™ªä¼´ï¼Œä½†ä»–çš„å½±éŸ¿æˆç‚ºä½ å¿ƒä¸­æ°¸é çš„åŠ›é‡ã€‚"
        ]
      }
    ];

    // äººç”Ÿä½¿å‘½æ¢ç´¢é¡Œå€å¡Šï¼ˆåæ€å¥èåˆåœ¨å¼•å°æ–‡å­—ä¸­ï¼Œä¸å†é¡å¤–å¡«ç­”ï¼‰
    const missionBlocks = [
      {
        id: "energy",
        title: "èƒ½é‡ä¾†æºï¼šä»€éº¼è®“ä½ è¦ºå¾—éˆé­‚åœ¨ç™¼å…‰ï¼Ÿ",
        description:
          "è«‹å‹¾é¸ä½ åšäº†æœƒã€Œè¶Šåšè¶Šæœ‰åŠ›é‡ã€çš„äº‹ã€‚é‚Šé¸é‚Šæƒ³ï¼šå“ªäº›æ™‚å€™ï¼Œä½ æœƒåœ¨å¿ƒè£¡é»˜é»˜èªªï¼šã€ŒåŸä¾†æˆ‘å°±æ˜¯ç‚ºäº†é€™ä»¶äº‹è€Œç”Ÿã€‚ã€",
        type: "energy"
      },
      {
        id: "bright",
        title: "ç”Ÿå‘½æé†’ï¼šå“ªäº›äº‹ä»¶æ›¾æš—ç¤ºä½ çš„ä½¿å‘½ï¼Ÿ",
        description:
          "è«‹å¯«ä¸‹ä½ çš„ä¸‰å€‹ã€Œäº®é»æ™‚åˆ»ã€â”€â”€è¢«çœ‹è¦‹ã€è¢«æ„Ÿè¬ã€æˆ–æ˜¯ä½ å¿ƒé ­å¾®ç†±çš„ç¬é–“ã€‚é‚Šå¯«é‚Šç•™æ„ï¼šé‚£äº›ç•«é¢ï¼Œå…¶å¯¦åœ¨å°ä½ èªªä»€éº¼ï¼Ÿ",
        type: "bright"
      },
      {
        id: "target",
        title: "ä½ æƒ³ç…§äº®èª°ï¼Ÿï¼ˆä½¿å‘½çš„å°è±¡ï¼‰",
        description:
          "ä¾ç›´è¦ºå‹¾é¸ä½ æœ€æƒ³é™ªä¼´ã€æœå‹™ã€æˆ–å®ˆè­·çš„æ—ç¾¤ã€‚æƒ³ä¸€æƒ³ï¼šå¦‚æœä½ èƒ½å¹«åŠ©æŸä¸€ç¾¤äººï¼Œä½ ç¬¬ä¸€å€‹æƒ³åˆ°çš„æ˜¯èª°ï¼Ÿç‚ºä»€éº¼æ˜¯ä»–å€‘ï¼Ÿ",
        type: "target"
      },
      {
        id: "painVision",
        title: "ä¸–ç•Œçš„ç—›é»èˆ‡ä½ çš„åå¹´é¡˜æ™¯",
        description:
          "å…ˆé¸å‡ºä½ æœ€æœ‰æ„Ÿçš„ä¸–ç•Œç—›é»ï¼Œå†å¯«ä¸‹ä½ åå¹´å¾Œæƒ³å®Œæˆçš„ä¸‰ä»¶äº‹ï¼Œæœ€å¾Œé¸æ“‡ä½ æƒ³æˆç‚ºçš„æ¨£å­ã€‚é‚Šå¯«é‚Šå•è‡ªå·±ï¼šå¦‚æœç”Ÿå‘½åªå‰©åå¹´ï¼Œæˆ‘ä»ç„¶æƒ³ç‚ºå“ªäº›äº‹å…¨åŠ›ä»¥èµ´ï¼Ÿ",
        type: "painVision"
      }
    ];

    const chanceTriggers = [3, 8, 12];
    const fateTriggers = [4, 9, 13];
    const missionTriggers = [2, 7, 11, 14];

    const traitCategories = [
      { id: "guide", name: "é™ªä¼´èˆ‡ç™‚ç™’", desc: "æ“…é•·é™ªåœ¨åˆ¥äººèº«é‚Šï¼Œæˆç‚ºæƒ…ç·’èˆ‡å¿ƒéˆçš„é å±±ã€‚" },
      { id: "educator", name: "çŸ¥è­˜èˆ‡æ•™è‚²", desc: "å–œæ­¡æ•™å­¸ã€åˆ†äº«èˆ‡å‚³éè§€å¿µã€‚" },
      { id: "creator", name: "å‰µä½œèˆ‡è¡¨é”", desc: "é€éä½œå“èªªè©±ï¼Œå–œæ­¡æŠŠæ„Ÿå—è®Šæˆå‰µä½œã€‚" },
      { id: "leader", name: "é ˜å°èˆ‡åœ˜éšŠ", desc: "åœ¨åœ˜éšŠä¸­è‡ªç„¶æ‰®æ¼”å¸¶é ­ã€æ•´åˆæˆ–ç™¼èµ·çš„äººã€‚" },
      { id: "innovator", name: "ç§‘æŠ€èˆ‡å‰µæ–°", desc: "å°ç³»çµ±ã€ç§‘æŠ€ã€è§£æ±ºå•é¡Œèˆ‡å‰µæ–°ç‰¹åˆ¥æœ‰æ„Ÿã€‚" },
      { id: "organizer", name: "è¦åŠƒèˆ‡ç³»çµ±åŒ–", desc: "å–œæ­¡è¦åŠƒã€æ•´ç†ã€è®“æ··äº‚è®Šå¾—æ¸…æ¥šæœ‰åºã€‚" },
      { id: "adventurer", name: "è¡Œå‹•èˆ‡æŒ‘æˆ°", desc: "äº«å—å˜—è©¦ã€æŒ‘æˆ°èˆ‡åœ¨è¡Œå‹•ä¸­æˆé•·ã€‚" },
      { id: "worldChanger", name: "ç¤¾æœƒèˆ‡ä¸–ç•Œé—œæ‡·", desc: "é—œå¿ƒç¤¾æœƒã€ç’°å¢ƒèˆ‡æ›´å¤§ç¯„åœçš„æ”¹è®Šã€‚" }
    ];

// è·Ÿä½ ç¾åœ¨çš„ traitCategories å°æ‡‰
const traitMeta = {
  guide: {
    name: "é™ªä¼´èˆ‡ç™‚ç™’",
    shortAdj: "æº«æŸ”",
    roleNoun: "å°èˆªè€…",
    tagline: "æ“…é•·é™ªä¼´èˆ‡å‚¾è½ï¼Œè®“åˆ¥äººåœ¨ä½ èº«é‚Šè¦ºå¾—è¢«ç†è§£ã€ä¸å­¤å–®ã€‚"
  },
  educator: {
    name: "çŸ¥è­˜èˆ‡æ•™è‚²",
    shortAdj: "é»ç‡ˆ",
    roleNoun: "å­¸ç¿’å¼•è·¯äºº",
    tagline: "å–œæ­¡æ•´ç†èˆ‡åˆ†äº«è§€å¿µï¼Œè®“çŸ¥è­˜åœ¨ä½ æ‰‹ä¸Šè®Šå¾—æœ‰æº«åº¦ã€‚"
  },
  creator: {
    name: "å‰µä½œèˆ‡è¡¨é”",
    shortAdj: "éˆæ„Ÿ",
    roleNoun: "å‰µä½œè€…",
    tagline: "æ“…é•·ç”¨æ–‡å­—ã€ç•«é¢æˆ–ä½œå“ï¼ŒæŠŠæ„Ÿå—è®Šæˆå¯ä»¥è¢«çœ‹è¦‹çš„å½¢ç‹€ã€‚"
  },
  leader: {
    name: "é ˜å°èˆ‡åœ˜éšŠ",
    shortAdj: "å‡èš",
    roleNoun: "é ˜è·¯äºº",
    tagline: "è‡ªç„¶æœƒçœ‹è¦‹å…¨å±€ã€ç…§é¡§åœ˜éšŠï¼Œå¸¶è‘—å¤§å®¶ä¸€èµ·å¾€å‰èµ°ã€‚"
  },
  innovator: {
    name: "ç§‘æŠ€èˆ‡å‰µæ–°",
    shortAdj: "ç³»çµ±",
    roleNoun: "é©æ–°è€…",
    tagline: "å–œæ­¡æ‹†è§£å•é¡Œã€è¨­è¨ˆæ›´å¥½çš„åšäº‹æ–¹å¼ï¼ŒæŠŠæ··äº‚è®Šæˆæ–°æ¶æ§‹ã€‚"
  },
  organizer: {
    name: "è¦åŠƒèˆ‡ç³»çµ±åŒ–",
    shortAdj: "ç§©åº",
    roleNoun: "ç·¨æ’è€…",
    tagline: "æ“…é•·è¦åŠƒã€æ’ç¨‹ã€æ•´ç†ï¼ŒæŠŠä¸€å †äº‹æƒ…æ’æˆæ¸…æ¥šçš„è·¯ç·šåœ–ã€‚"
  },
  adventurer: {
    name: "è¡Œå‹•èˆ‡æŒ‘æˆ°",
    shortAdj: "è¡Œå‹•",
    roleNoun: "é–‹æ‹“è€…",
    tagline: "é¡˜æ„å…ˆè¸å‡ºå»è©¦ã€å…ˆåšå†èªªï¼Œå¾è¡Œå‹•ä¸­é•·å‡ºå‹‡æ°£èˆ‡ç¶“é©—ã€‚"
  },
  worldChanger: {
    name: "ç¤¾æœƒèˆ‡ä¸–ç•Œé—œæ‡·",
    shortAdj: "é¡˜æ™¯",
    roleNoun: "æ”¹è®Šè€…",
    tagline: "çœ‹è¦‹ä¸–ç•Œçš„ç—›ï¼Œä¹Ÿå¿ä¸ä½æƒ³å¤šåšä¸€é»ï¼Œè®“ç’°å¢ƒæ¯”æ˜¨å¤©å¥½ä¸€é»é»ã€‚"
  }
};


    // =============================
    // Game State
    // =============================
    let state = {
      player: {
        name: "",
        gender: "",
        declaration: ""
      },
      selections: {
        abilities: [],
        values: [],
        companions: []
      },
      journey: {
        currentIndex: 0,
        log: [],
        gained: [],
        lost: [],
        items: []
      },
      reflections: ["", "", ""],
      timer: {
        remaining: 20,
        id: null,
        locked: false
      },
      cardsUsed: {
        chance: 0,
        fate: 0
      },
      currentReflectionIndex: 0,
      missions: {
        energy: {
          selected: [],
          other: ""
        },
        bright: {
          moments: ["", "", ""]
        },
        target: {
          selected: [],
          other: ""
        },
        painVision: {
          pains: [],
          otherPain: "",
          tenYears: ["", "", ""],
          vision: "",
          visionOther: ""
        }
      },
      missionQueue: [],
      currentMission: null
    };

    const $ = (id) => document.getElementById(id);

    function showScreen(id) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      $(id).classList.add("active");
    }

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function resetState() {
      state = {
        player: { name: "", gender: "", declaration: "" },
        selections: { abilities: [], values: [], companions: [] },
        journey: {
          currentIndex: 0,
          log: [],
          gained: [],
          lost: [],
          items: []
        },
        reflections: ["", "", ""],
        timer: { remaining: 20, id: null, locked: false },
        cardsUsed: { chance: 0, fate: 0 },
        currentReflectionIndex: 0,
        missions: {
          energy: { selected: [], other: "" },
          bright: { moments: ["", "", ""] },
          target: { selected: [], other: "" },
          painVision: {
            pains: [],
            otherPain: "",
            tenYears: ["", "", ""],
            vision: "",
            visionOther: ""
          }
        },
        missionQueue: [],
        currentMission: null
      };
      $("player-name").value = "";
      $("declaration").value = "";
      document.querySelectorAll("input[name='gender']").forEach(r => r.checked = false);
      $("reflection-answer").value = "";
      $("mini-log").innerHTML = "";
    }

    // =============================
    // Setup Screen Rendering
    // =============================
    function renderCheckboxGroup(containerId, options, groupName) {
      const container = $(containerId);
      container.innerHTML = "";
      options.forEach((opt, index) => {
        const id = `${groupName}-${index}`;
        const label = document.createElement("label");
        label.className = "checkbox-pill";
        const input = document.createElement("input");
        input.type = "checkbox";
        input.value = opt;
        input.name = groupName;
        input.id = id;
        label.appendChild(input);
        const span = document.createElement("span");
        span.textContent = opt;
        label.appendChild(span);
        container.appendChild(label);
      });
    }

    function getCheckedValues(name) {
      const list = Array.from(document.querySelectorAll(`input[name='${name}']:checked`));
      return list.map(i => i.value);
    }

    function updateCounters() {
      $("abilities-counter").textContent = `å·²é¸æ“‡ï¼š${getCheckedValues("abilities").length} / 3`;
      $("values-counter").textContent = `å·²é¸æ“‡ï¼š${getCheckedValues("values").length} / 3`;
      $("companions-counter").textContent = `å·²é¸æ“‡ï¼š${getCheckedValues("companions").length} / 3`;
    }

    // =============================
    // Timer
    // =============================
    function stopTimer() {
      if (state.timer.id !== null) {
        clearInterval(state.timer.id);
        state.timer.id = null;
      }
    }

    function startTimer() {
      stopTimer();
      state.timer.remaining = 20;
      state.timer.locked = false;
      $("timer-count").textContent = state.timer.remaining;
      state.timer.id = setInterval(() => {
        state.timer.remaining -= 1;
        $("timer-count").textContent = state.timer.remaining;
        if (state.timer.remaining <= 0) {
          stopTimer();
          if (!state.timer.locked) {
            state.timer.locked = true;
            autoSelectChoice();
          }
        }
      }, 1000);
    }

    function autoSelectChoice() {
      const currentScenario = scenarios[state.journey.currentIndex];
      if (!currentScenario) return;
      const firstChoice = currentScenario.choices[0];
      handleChoice(currentScenario, firstChoice, true);
    }

    // =============================
    // Effect Parsing
    // =============================
    function parseEffects(effectText) {
      const result = { gained: [], lost: [] };
      if (!effectText) return result;
      const segments = effectText.split(/[ï¼›;]+/);
      segments.forEach(seg => {
        let s = seg.trim();
        if (!s) return;
        if (s.startsWith("ç²å¾—ï¼š")) {
          let body = s.replace("ç²å¾—ï¼š", "");
          body.split(/[ã€ï¼Œ,]/).map(x => x.trim()).filter(x => x).forEach(x => result.gained.push(x));
        } else if (s.startsWith("å¤±å»ï¼š") || s.startsWith("ä»˜å‡ºï¼š") || s.startsWith("æ”¾ä¸‹ï¼š")) {
          let body = s.replace(/^å¤±å»ï¼š|^ä»˜å‡ºï¼š|^æ”¾ä¸‹ï¼š/, "");
          body.split(/[ã€â€ƒï¼Œ,]/).map(x => x.trim()).filter(x => x).forEach(x => result.lost.push(x));
        }
      });
      return result;
    }

    // =============================
    // Journey Rendering
    // =============================
    function appendLog(text) {
      state.journey.log.push(text);
      const mini = $("mini-log");
      const p = document.createElement("p");
      p.textContent = text;
      mini.appendChild(p);
      mini.scrollTop = mini.scrollHeight;
    }

    function renderScenario() {
      const index = state.journey.currentIndex;
      if (index >= scenarios.length) {
        handleJourneyEnd();
        return;
      }
      const scenario = scenarios[index];
      $("progress-text").textContent = `ç¬¬ ${scenario.id} / ${scenarios.length} é¡Œ`;
      const name = state.player.name || "æ—…äºº";
      $("player-label").textContent = `${name} çš„äººç”Ÿæ—…ç¨‹`;
      $("scenario-title").textContent = scenario.title;
      $("scenario-desc").textContent = scenario.description;

      const choicesContainer = $("choices-container");
      choicesContainer.innerHTML = "";

      scenario.choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.className = "btn choice-btn";
        btn.textContent = `${choice.id}. ${choice.text}`;
        btn.addEventListener("click", () => {
          if (state.timer.locked) return;
          state.timer.locked = true;
          stopTimer();
          handleChoice(scenario, choice, false);
        });
        choicesContainer.appendChild(btn);
      });

      startTimer();
    }

    function handleChoice(scenario, choice, isTimeout) {
      const number = scenario.id;
      const choiceText = isTimeout
        ? `ï¼ˆè¶…éæ™‚é–“ï¼Œç”±ç³»çµ±æ›¿ä½ é¸æ“‡ï¼‰${choice.id}. ${choice.text}`
        : `${choice.id}. ${choice.text}`;
      const logText = `ç¬¬ ${number} é¡Œã€${scenario.title}ã€‘ï¼šä½ é¸æ“‡äº†ã€Œ${choice.text}ã€ã€‚æ•ˆæœï¼š${choice.effect}`;
      appendLog(logText);

      if (choice.effect && choice.effect.trim() !== "") {
        state.journey.items.push(choice.effect);
        const parsed = parseEffects(choice.effect);
        state.journey.gained.push(...parsed.gained);
        state.journey.lost.push(...parsed.lost);
      }

      state.journey.currentIndex += 1;
      const currentNumber = number;

      // ä¸‰æ¬¡åŸæœ¬çš„éˆé­‚æå•
      if (currentNumber === 5) {
        openReflection(0);
        return;
      } else if (currentNumber === 10) {
        openReflection(1);
        return;
      } else if (currentNumber === 15) {
        openReflection(2);
        return;
      }

      // ä½¿å‘½æ¢ç´¢é¡Œï¼ˆé †åºéš¨æ©Ÿï¼‰
      if (missionTriggers.includes(currentNumber) && state.missionQueue.length > 0) {
        const nextMission = state.missionQueue.shift();
        openMission(nextMission);
        return;
      }

      // æ©Ÿæœƒå¡
      if (chanceTriggers.includes(currentNumber) && state.cardsUsed.chance < 3) {
        openChanceCard();
        return;
      }

      // å‘½é‹å¡
      if (fateTriggers.includes(currentNumber) && state.cardsUsed.fate < 3) {
        openFateCard();
        return;
      }

      renderScenario();
    }

    // =============================
    // Reflection (3 æ¬¡éˆé­‚æå•)
    // =============================
    function openReflection(refIndex) {
      state.currentReflectionIndex = refIndex;
      $("reflection-answer").value = state.reflections[refIndex] || "";
      let question = "";
      if (refIndex === 0) {
        question = "æ­¤åˆ»ï¼Œè«‹å¯«ä¸‹ä½ ç¾åœ¨è¦ºå¾—è‡ªå·±æœ€åœ¨ä¹çš„ä¸‰å€‹åƒ¹å€¼æ˜¯ä»€éº¼ï¼Ÿ";
      } else if (refIndex === 1) {
        question = "å¦‚æœä½ èƒ½ç‚ºä¸€ç¾¤äººé»äº®ä¸€ç›ç‡ˆï¼Œä½ æœ€æƒ³ç…§äº®çš„æ˜¯å“ªä¸€ç¾¤äººï¼Ÿç‚ºä»€éº¼ï¼Ÿ";
      } else {
        question = "è«‹å®Œæˆé€™å¥è©±ï¼šã€æˆ‘å­˜åœ¨ï¼Œæ˜¯ç‚ºäº†ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ã€‚ã€";
      }
      $("reflection-question").textContent = question;
      showScreen("reflection-screen");
    }

    function finishReflection() {
      const idx = state.currentReflectionIndex;
      const val = $("reflection-answer").value.trim();
      state.reflections[idx] = val;
      if (idx === 2) {
        handleJourneyEnd();
      } else {
        showScreen("journey-screen");
        renderScenario();
      }
    }

    // =============================
    // ä½¿å‘½æ¢ç´¢é¡Œ UIï¼ˆåæ€å¥å·²èåˆåœ¨å¼•å°æ–‡å­—ï¼‰
    // =============================
    function openMission(block) {
      state.currentMission = block;
      $("mission-title").textContent = block.title;
      $("mission-desc").textContent = block.description;
      const body = $("mission-body");
      body.innerHTML = "";

      if (block.type === "energy") {
        const sec = document.createElement("div");
        sec.className = "mission-section";

        const h = document.createElement("h3");
        h.textContent = "èƒ½é‡ä¾†æºï¼šè«‹å‹¾é¸ä½ åšäº†æœƒè¶Šåšè¶Šæœ‰åŠ›é‡çš„äº‹ã€‚";
        sec.appendChild(h);

        const sub = document.createElement("p");
        sub.className = "mission-subtitle";
        sub.textContent = "å¯ä»¥å¤šé¸ï¼Œé‚Šé¸é‚Šæ„Ÿå—ï¼šå“ªäº›äº‹æœƒè®“ä½ è¶Šåšè¶Šç²¾ç¥ã€è¶Šåšè¶Šåƒè‡ªå·±ã€‚";
        sec.appendChild(sub);

        const options = [
          "æ•™äººã€åˆ†äº«çŸ¥è­˜",
          "è§£æ±ºå•é¡Œã€ç ”ç©¶",
          "å‰µä½œï¼ˆå¯«ä½œã€ç•«ç•«ã€å½±ç‰‡ã€éŸ³æ¨‚â€¦ï¼‰",
          "å¹«åŠ©åˆ¥äººã€é™ªä¼´æŸç¾¤äºº",
          "åƒèˆ‡åœ˜éšŠã€å¸¶é ˜æ´»å‹•",
          "é‹å‹•ã€æŒ‘æˆ°èº«é«”æ¥µé™",
          "å¯«ç¨‹å¼ã€åšç”¢å“ã€å‰µæ–°",
          "è¦åŠƒäº‹æƒ…ã€è®“æ··äº‚è®Šæ•´é½Š",
          "å‚¾è½åˆ¥äººã€æ”¯æŒä»–äººæƒ…ç·’"
        ];

        const group = document.createElement("div");
        group.className = "checkbox-group";
        options.forEach((opt, idx) => {
          const label = document.createElement("label");
          label.className = "checkbox-pill";
          const input = document.createElement("input");
          input.type = "checkbox";
          input.name = "mission-energy-option";
          input.value = opt;
          label.appendChild(input);
          const span = document.createElement("span");
          span.textContent = opt;
          label.appendChild(span);
          group.appendChild(label);
        });
        sec.appendChild(group);

        const otherLabel = document.createElement("label");
        otherLabel.textContent = "å…¶ä»–ï¼š";
        sec.appendChild(otherLabel);
        const otherInput = document.createElement("input");
        otherInput.type = "text";
        otherInput.id = "mission-energy-other";
        otherInput.placeholder = "ä½ é‚„æœƒå› ç‚ºä»€éº¼äº‹æƒ…è€Œç™¼å…‰ï¼Ÿ";
        sec.appendChild(otherInput);

        body.appendChild(sec);
      } else if (block.type === "bright") {
        const sec = document.createElement("div");
        sec.className = "mission-section";

        const h = document.createElement("h3");
        h.textContent = "è«‹å¯«ä¸‹ä½ çš„ä¸‰å€‹ã€Œäº®é»æ™‚åˆ»ã€";
        sec.appendChild(h);

        const sub = document.createElement("p");
        sub.className = "mission-subtitle";
        sub.textContent = "å¯ä»¥æ˜¯è¢«ç¨±è®šã€è¢«æ„Ÿè¬ã€è¢«éœ€è¦ï¼Œæˆ–æ˜¯ä½ è‡ªå·±è¦ºå¾—å¾ˆæ»¿è¶³çš„ç¬é–“ã€‚";
        sec.appendChild(sub);

        const hint = document.createElement("p");
        hint.className = "small-text";
        hint.textContent = "é‚Šå¯«é‚Šæƒ³ï¼šåœ¨é‚£äº›è¢«çœ‹è¦‹ã€è¢«æ„Ÿè¬ã€æˆ–å¿ƒé ­å¾®ç†±çš„ç¬é–“ï¼Œä½ çœ‹åˆ°äº†ä»€éº¼ç·šç´¢ï¼Ÿ";
        sec.appendChild(hint);

        const box = document.createElement("div");
        box.className = "mission-multi-inputs";

        for (let i = 1; i <= 3; i++) {
          const lab = document.createElement("label");
          lab.textContent = `äº®é»æ™‚åˆ» ${i}`;
          box.appendChild(lab);
          const input = document.createElement("input");
          input.type = "text";
          input.id = `mission-bright-${i}`;
          input.placeholder = "ç°¡å–®æè¿°å ´æ™¯æˆ–ç™¼ç”Ÿäº†ä»€éº¼äº‹";
          box.appendChild(input);
        }

        sec.appendChild(box);
        body.appendChild(sec);
      } else if (block.type === "target") {
        const sec = document.createElement("div");
        sec.className = "mission-section";
        const h = document.createElement("h3");
        h.textContent = "ä½ æƒ³ç…§äº®èª°ï¼Ÿï¼ˆä½¿å‘½çš„å°è±¡ï¼‰";
        sec.appendChild(h);

        const sub = document.createElement("p");
        sub.className = "mission-subtitle";
        sub.textContent = "ä¾ç›´è¦ºå‹¾é¸ï¼Œä½ å¯ä»¥å¤šé¸ã€‚";
        sec.appendChild(sub);

        const hint = document.createElement("p");
        hint.className = "small-text";
        hint.textContent = "æƒ³åƒï¼šå¦‚æœä½ èƒ½å¹«åŠ©æŸä¸€ç¾¤äººï¼Œä½ æœ€å…ˆæƒ³åˆ°çš„æ˜¯èª°ï¼Ÿç‚ºä»€éº¼æ˜¯ä»–å€‘ï¼Ÿ";
        sec.appendChild(hint);

        const options = [
          "è¿·æƒ˜çš„é’å¹´",
          "å¿ƒéˆå—å‚·çš„äºº",
          "å­¦ç”Ÿ / å…’ç«¥",
          "è¿½å¤¢çš„äºº",
          "å®¶åº­ï¼æœ‹å‹",
          "å‰µä½œè€…",
          "ç¤¾å€æˆ–ç¤¾åœ˜",
          "ç§‘æŠ€èˆ‡ç¤¾æœƒä¹‹é–“çš„æ©‹æ¨‘",
          "åœ°çƒèˆ‡ç’°å¢ƒ"
        ];

        const group = document.createElement("div");
        group.className = "checkbox-group";
        options.forEach((opt, idx) => {
          const label = document.createElement("label");
          label.className = "checkbox-pill";
          const input = document.createElement("input");
          input.type = "checkbox";
          input.name = "mission-target-option";
          input.value = opt;
          label.appendChild(input);
          const span = document.createElement("span");
          span.textContent = opt;
          label.appendChild(span);
          group.appendChild(label);
        });
        sec.appendChild(group);

        const otherLabel = document.createElement("label");
        otherLabel.textContent = "å…¶ä»–ï¼š";
        sec.appendChild(otherLabel);
        const otherInput = document.createElement("input");
        otherInput.type = "text";
        otherInput.id = "mission-target-other";
        otherInput.placeholder = "å¦‚æœä½ å¿ƒä¸­æµ®ç¾çš„æ˜¯æŸå€‹æ›´å…·é«”çš„æ—ç¾¤ï¼Œå¯ä»¥å¯«åœ¨é€™è£¡ã€‚";
        sec.appendChild(otherInput);

        body.appendChild(sec);
      } else if (block.type === "painVision") {
        const secPain = document.createElement("div");
        secPain.className = "mission-section";
        const h1 = document.createElement("h3");
        h1.textContent = "ä¸–ç•Œçš„ç—›é»ï¼šä½ æœ€æƒ³è§£æ±ºä»€éº¼å•é¡Œï¼Ÿ";
        secPain.appendChild(h1);

        const sub1 = document.createElement("p");
        sub1.className = "mission-subtitle";
        sub1.textContent = "è«‹é¸å‡ºä½ æœ€æœ‰æ„Ÿçš„å•é¡Œï¼Œå¯ä»¥å¤šé¸ã€‚";
        secPain.appendChild(sub1);

        const hint1 = document.createElement("p");
        hint1.className = "small-text";
        hint1.textContent = "æƒ³ä¸€æƒ³ï¼šå“ªä¸€ç¨®ç—›ï¼Œæ˜¯ä½ çœ‹åˆ°å°±æœƒå¿ä¸ä½æƒ³ä¼¸æ‰‹çš„ï¼Ÿ";
        secPain.appendChild(hint1);

        const painOptions = [
          "å­¤å–®èˆ‡ç„¡åŠ›æ„Ÿ",
          "æ•™è‚²ä¸å¹³ç­‰",
          "å¿ƒç†å¥åº·",
          "é’å¹´è¿·å¤±ã€æ²’æœ‰æ–¹å‘",
          "ç§‘æŠ€èˆ‡äººæ€§æ–·è£‚",
          "é‡‘éŒ¢ç„¦æ…®èˆ‡ç¼ºä¹ç†è²¡çŸ¥è­˜",
          "ç’°å¢ƒè­°é¡Œ",
          "äººéš›è¡çª",
          "è‡ªæˆ‘èªåŒå›°é›£",
          "ç¤¾æœƒçš„ä¸å…¬"
        ];

        const painGroup = document.createElement("div");
        painGroup.className = "checkbox-group";
        painOptions.forEach((opt) => {
          const label = document.createElement("label");
          label.className = "checkbox-pill";
          const input = document.createElement("input");
          input.type = "checkbox";
          input.name = "mission-pain-option";
          input.value = opt;
          label.appendChild(input);
          const span = document.createElement("span");
          span.textContent = opt;
          label.appendChild(span);
          painGroup.appendChild(label);
        });
        secPain.appendChild(painGroup);

        const painOtherLabel = document.createElement("label");
        painOtherLabel.textContent = "å…¶ä»–ï¼š";
        secPain.appendChild(painOtherLabel);
        const painOtherInput = document.createElement("input");
        painOtherInput.type = "text";
        painOtherInput.id = "mission-pain-other";
        painOtherInput.placeholder = "ä½ å¿ƒä¸­é‚„æœ‰å…¶ä»–è¦ºå¾—å¾ˆç—›çš„åœ°æ–¹å—ï¼Ÿ";
        secPain.appendChild(painOtherInput);

        const secTen = document.createElement("div");
        secTen.className = "mission-section";
        const h2 = document.createElement("h3");
        h2.textContent = "å¯«ä¸‹ä½ å¸Œæœ›åå¹´å¾Œå·²ç¶“å®Œæˆçš„ä¸‰ä»¶äº‹";
        secTen.appendChild(h2);

        const sub2 = document.createElement("p");
        sub2.className = "mission-subtitle";
        sub2.textContent = "å…ˆä¸ç”¨ç®¡èƒ½ä¸èƒ½åšåˆ°ï¼Œå°±å¯«ä¸‹æ­¤åˆ»æœ€çœŸå¯¦çš„æ¸´æœ›ã€‚";
        secTen.appendChild(sub2);

        const hint2 = document.createElement("p");
        hint2.className = "small-text";
        hint2.textContent = "åå•è‡ªå·±ï¼šå¦‚æœç”Ÿå‘½åªå‰©åå¹´ï¼Œä»€éº¼æ˜¯ä½ ä»ç„¶æƒ³å…¨åŠ›ä»¥èµ´çš„ï¼Ÿ";
        secTen.appendChild(hint2);

        const tenBox = document.createElement("div");
        tenBox.className = "mission-multi-inputs";
        for (let i = 1; i <= 3; i++) {
          const lab = document.createElement("label");
          lab.textContent = `åå¹´å¾Œçš„ç›®æ¨™ ${i}`;
          tenBox.appendChild(lab);
          const input = document.createElement("input");
          input.type = "text";
          input.id = `mission-ten-${i}`;
          input.placeholder = "ä¾‹å¦‚ï¼šé™ªä¼´XXXæ—ç¾¤ã€å®ŒæˆæŸå€‹ä½œå“ã€å»ºç«‹ä¸€å€‹ç©ºé–“â€¦";
          tenBox.appendChild(input);
        }
        secTen.appendChild(tenBox);

        const secVision = document.createElement("div");
        secVision.className = "mission-section";
        const h3 = document.createElement("h3");
        h3.textContent = "è«‹é¸æ“‡ä½ çš„é¡˜æ™¯æ–¹å‘ï¼šä½ æƒ³æˆç‚ºå“ªä¸€ç¨®äººï¼Ÿ";
        secVision.appendChild(h3);

        const visionOptions = [
          "æˆç‚ºèƒ½é™ªä¼´èˆ‡ç™‚ç™’çš„äºº",
          "æˆç‚ºæ¨å‹•çŸ¥è­˜èˆ‡æ•™è‚²çš„äºº",
          "æˆç‚ºå‰µæ–°èˆ‡ç§‘æŠ€çš„æ©‹æ¨‘",
          "æˆç‚ºèƒ½å¸¶é ˜åœ˜éšŠçš„äºº",
          "æˆç‚ºè‡ªç”±ã€æœ‰é¸æ“‡çš„äºº",
          "æˆç‚ºå¿ƒéˆå¯Œè¶³çš„äºº",
          "æˆç‚ºæ”¹è®Šä¸–ç•Œçš„äºº",
          "æˆç‚ºèƒ½å‰µé€ ç¾å¥½ä½œå“çš„äºº"
        ];

        const visionGroup = document.createElement("div");
        visionGroup.className = "radio-group";
        visionOptions.forEach((opt) => {
          const label = document.createElement("label");
          const input = document.createElement("input");
          input.type = "radio";
          input.name = "mission-vision";
          input.value = opt;
          label.appendChild(input);
          const span = document.createElement("span");
          span.textContent = opt;
          label.appendChild(span);
          visionGroup.appendChild(label);
        });
        secVision.appendChild(visionGroup);

        const visionOtherLabel = document.createElement("label");
        visionOtherLabel.textContent = "å…¶ä»–ï¼š";
        secVision.appendChild(visionOtherLabel);
        const visionOtherInput = document.createElement("input");
        visionOtherInput.type = "text";
        visionOtherInput.id = "mission-vision-other";
        visionOtherInput.placeholder = "å¦‚æœä½ æœ‰ä¸€å€‹å®Œå…¨å±¬æ–¼è‡ªå·±çš„é¡˜æ™¯å½¢å®¹è©ï¼Œå¯«åœ¨é€™è£¡ã€‚";
        secVision.appendChild(visionOtherInput);

        body.appendChild(secPain);
        body.appendChild(secTen);
        body.appendChild(secVision);
      }

      showScreen("mission-screen");
    }

    function saveCurrentMission() {
      const block = state.currentMission;
      if (!block) return;
      if (block.type === "energy") {
        const selected = Array.from(document.querySelectorAll("input[name='mission-energy-option']:checked"))
          .map(i => i.value);
        const other = $("mission-energy-other") ? $("mission-energy-other").value.trim() : "";
        state.missions.energy.selected = selected;
        state.missions.energy.other = other;
      } else if (block.type === "bright") {
        const moments = [];
        for (let i = 1; i <= 3; i++) {
          const el = $(`mission-bright-${i}`);
          moments.push(el ? el.value.trim() : "");
        }
        state.missions.bright.moments = moments;
      } else if (block.type === "target") {
        const selected = Array.from(document.querySelectorAll("input[name='mission-target-option']:checked"))
          .map(i => i.value);
        const other = $("mission-target-other") ? $("mission-target-other").value.trim() : "";
        state.missions.target.selected = selected;
        state.missions.target.other = other;
      } else if (block.type === "painVision") {
        const pains = Array.from(document.querySelectorAll("input[name='mission-pain-option']:checked"))
          .map(i => i.value);
        const otherPain = $("mission-pain-other") ? $("mission-pain-other").value.trim() : "";
        const tenYears = [];
        for (let i = 1; i <= 3; i++) {
          const el = `mission-ten-${i}`;
          const dom = $(el);
          tenYears.push(dom ? dom.value.trim() : "");
        }
        const visionRadio = document.querySelector("input[name='mission-vision']:checked");
        const vision = visionRadio ? visionRadio.value : "";
        const visionOther = $("mission-vision-other") ? $("mission-vision-other").value.trim() : "";

        state.missions.painVision.pains = pains;
        state.missions.painVision.otherPain = otherPain;
        state.missions.painVision.tenYears = tenYears;
        state.missions.painVision.vision = vision;
        state.missions.painVision.visionOther = visionOther;
      }
    }

    // =============================
    // Chance & Fate Cards
    // =============================
    function openChanceCard() {
      state.cardsUsed.chance += 1;
      const card = chanceCards[Math.floor(Math.random() * chanceCards.length)];
      $("card-title").textContent = `âœ¨ æ©Ÿæœƒå¡ï¼š${card.title}`;
      $("card-description").textContent = card.description;
      const container = $("card-options");
      container.innerHTML = "";
      $("card-close").style.display = "none";
      $("card-footnote").textContent = "æ©Ÿæœƒï¼Œæ˜¯ä½ å¯ä»¥ä¸»å‹•æŠ“ä½çš„å¯èƒ½ã€‚è«‹é¸æ“‡ä¸€å€‹ä½ æƒ³æ¡å–çš„è¡Œå‹•ã€‚";

      card.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "btn choice-btn";
        btn.textContent = opt.text;
        btn.addEventListener("click", () => {
          const logText = `ã€æ©Ÿæœƒå¡ï¼š${card.title}ã€‘ä½ é¸æ“‡äº†ã€Œ${opt.text}ã€ã€‚æ•ˆæœï¼š${opt.effect}`;
          appendLog(logText);
          if (opt.effect && opt.effect.trim() !== "") {
            state.journey.items.push(opt.effect);
            const parsed = parseEffects(opt.effect);
            state.journey.gained.push(...parsed.gained);
            state.journey.lost.push(...parsed.lost);
          }
          closeCardModal();
          showScreen("journey-screen");
          renderScenario();
        });
        container.appendChild(btn);
      });

      $("card-modal").classList.remove("hidden");
    }

    function openFateCard() {
      state.cardsUsed.fate += 1;
      const card = fateCards[Math.floor(Math.random() * fateCards.length)];
      $("card-title").textContent = `ğŸŒ‘ å‘½é‹å¡ï¼š${card.title}`;
      $("card-description").textContent = card.description;
      const container = $("card-options");
      container.innerHTML = "";
      const outcome = card.outcomes[Math.floor(Math.random() * card.outcomes.length)];
      const p = document.createElement("p");
      p.className = "small-text";
      p.textContent = outcome;
      container.appendChild(p);
      $("card-footnote").textContent = "å‘½é‹ï¼Œæ˜¯ä½ ç„¡æ³•é¸æ“‡ä½†å¯ä»¥å›æ‡‰çš„äº‹ã€‚è«‹æ¥å—é€™ä»½ç™¼ç”Ÿã€‚";
      $("card-close").style.display = "inline-flex";
      $("card-close").onclick = () => {
        const logText = `ã€å‘½é‹å¡ï¼š${card.title}ã€‘ç™¼ç”Ÿçš„çµæœï¼š${outcome}`;
        appendLog(logText);
        state.journey.items.push(outcome);
        const parsed = parseEffects(outcome.replace("ã€‚", ""));
        state.journey.gained.push(...parsed.gained);
        state.journey.lost.push(...parsed.lost);

        closeCardModal();
        showScreen("journey-screen");
        renderScenario();
      };
      $("card-modal").classList.remove("hidden");
    }

    function closeCardModal() {
      $("card-modal").classList.add("hidden");
      $("card-options").innerHTML = "";
    }

    // =============================
    // Summary & Radar
    // =============================
    function uniqueArray(arr) {
      return Array.from(new Set(arr.filter(x => x && x.trim() !== "")));
    }

    function pickLastUnique(arr, count) {
      const result = [];
      for (let i = arr.length - 1; i >= 0 && result.length < count; i--) {
        const v = arr[i];
        if (!v || !v.trim()) continue;
        if (!result.includes(v)) {
          result.unshift(v);
        }
      }
      return result;
    }

    // æ–°ç‰ˆï¼šç‰¹è³ªåˆ†æ•¸è¨ˆç®—ï¼ˆæ•´åˆæ‰€æœ‰é¸é …ï¼‹å¹³æ»‘åŒ–ï¼‰
    function computeTraitScores() {
      const scores = {};
      traitCategories.forEach(c => scores[c.id] = 0);

      const add = (id, value = 1) => {
        if (scores[id] !== undefined) scores[id] += value;
      };

      const m = state.missions;

      // 1. å‡ºç™¼å‰çš„èƒ½åŠ›ï¼ˆabilitiesï¼‰
      (state.selections.abilities || []).forEach(ab => {
        if (ab === "å‚¾è½") add("guide", 2);
        if (ab === "åˆ†æåŠ›") { add("innovator", 1); add("organizer", 1); }
        if (ab === "å‰µæ„") add("creator", 2);
        if (ab === "è¡¨é”èƒ½åŠ›") { add("educator", 1); add("creator", 1); }
        if (ab === "é‹å‹•èƒ½åŠ›") add("adventurer", 2);
        if (ab === "å …æŒåŠ›") { add("adventurer", 1); add("leader", 1); }
        if (ab === "è§£æ±ºå•é¡Œ") { add("innovator", 2); }
        if (ab === "è€å¿ƒ") { add("guide", 1); add("organizer", 1); }
        if (ab === "æƒ³åƒåŠ›") add("creator", 1);
        if (ab === "æŠ€è¡“èƒ½åŠ›ï¼ˆå¯«ç¨‹å¼ã€è¨­è¨ˆï¼‰") { add("innovator", 2); add("creator", 1); }
        if (ab === "è§€å¯ŸåŠ›") { add("organizer", 1); add("guide", 1); }
        if (ab === "å‹‡æ°£") { add("adventurer", 1); add("leader", 1); }
      });

      // 2. å‡ºç™¼å‰çš„åƒ¹å€¼è§€ï¼ˆvaluesï¼‰
      (state.selections.values || []).forEach(v => {
        if (v === "èª å¯¦æ¯”æˆåŠŸé‡è¦") { add("guide", 1); add("leader", 1); }
        if (v === "ä¸€å®šè¦å­¸æœƒæ„›äººèˆ‡è¢«æ„›") add("guide", 2);
        if (v === "åŠªåŠ›ä¸ä¸€å®šæˆåŠŸï¼Œä½†ä¸åŠªåŠ›æ›´ä¸æœƒæˆåŠŸ") { add("adventurer", 1); add("leader", 1); }
        if (v === "è¦ç…§é¡§å¥½èº«é«”") add("adventurer", 1);
        if (v === "æœ‹å‹æ˜¯äººç”Ÿé‡è¦çš„æ”¯æŸ±") add("guide", 1);
        if (v === "å¤±æ•—æ˜¯æˆé•·çš„ä¸€éƒ¨åˆ†") { add("adventurer", 1); add("leader", 1); }
        if (v === "ä¿¡ä»»è¦æ…¢æ…¢å»ºç«‹") add("guide", 1);
        if (v === "ä¸–ç•Œå¾ˆå¤§ï¼Œè¦å¤šæ¢ç´¢") { add("adventurer", 2); add("worldChanger", 1); }
        if (v === "é‡‘éŒ¢é‡è¦ï¼Œä½†ä¸æ˜¯å…¨éƒ¨") { add("organizer", 1); add("worldChanger", 1); }
        if (v === "å¹«åŠ©åˆ¥äººä¹Ÿæ˜¯æˆå°±è‡ªå·±") { add("guide", 1); add("worldChanger", 1); }
      });

      // 3. åŒè¡Œå¤¥ä¼´ï¼ˆcompanionsï¼‰
      (state.selections.companions || []).forEach(c => {
        if (c === "çˆºçˆºæˆ–å¥¶å¥¶" || c === "çˆ¸çˆ¸" || c === "åª½åª½") add("guide", 1);
        if (c === "å“¥å“¥ / å§Šå§Š" || c === "å¼Ÿå¼Ÿ / å¦¹å¦¹") add("guide", 1);
        if (c === "æœ€çŸ¥å¿ƒçš„å¥½æœ‹å‹") add("guide", 1);
        if (c === "ä¸€ä½å•Ÿç™¼ä½ çš„è€å¸«") { add("educator", 2); }
        if (c === "ä¸€ä½ç¸½æ˜¯æ”¯æŒä½ çš„å‰è¼©") { add("leader", 1); add("guide", 1); }
        if (c === "ä¸€ä½ä½ ç¾åœ¨å¾ˆåœ¨ä¹çš„å°è±¡") add("guide", 1);
        if (c === "ä¸€ä½ç²¾ç¥ / ä¿¡ä»°ä¸Šçš„å°å¸«") { add("guide", 1); add("worldChanger", 1); }
      });

      // 4. èƒ½é‡ä¾†æºï¼ˆenergyï¼‰
      (m.energy.selected || []).forEach(opt => {
        if (opt.includes("æ•™äººã€åˆ†äº«çŸ¥è­˜")) add("educator", 2);
        if (opt.includes("è§£æ±ºå•é¡Œã€ç ”ç©¶")) { add("innovator", 2); add("educator", 1); }
        if (opt.includes("å‰µä½œï¼ˆå¯«ä½œã€ç•«ç•«ã€å½±ç‰‡ã€éŸ³æ¨‚")) add("creator", 2);
        if (opt.includes("å¹«åŠ©åˆ¥äººã€é™ªä¼´æŸç¾¤äºº")) { add("guide", 2); add("worldChanger", 1); }
        if (opt.includes("åƒèˆ‡åœ˜éšŠã€å¸¶é ˜æ´»å‹•")) { add("leader", 2); add("organizer", 1); }
        if (opt.includes("é‹å‹•ã€æŒ‘æˆ°èº«é«”æ¥µé™")) add("adventurer", 2);
        if (opt.includes("å¯«ç¨‹å¼ã€åšç”¢å“ã€å‰µæ–°")) { add("innovator", 2); add("organizer", 1); }
        if (opt.includes("è¦åŠƒäº‹æƒ…ã€è®“æ··äº‚è®Šæ•´é½Š")) add("organizer", 2);
        if (opt.includes("å‚¾è½åˆ¥äººã€æ”¯æŒä»–äººæƒ…ç·’")) add("guide", 2);
      });

      // 5. æƒ³ç…§äº®çš„å°è±¡ï¼ˆtargetï¼‰
      (m.target.selected || []).forEach(opt => {
        if (opt === "è¿·æƒ˜çš„é’å¹´") { add("guide", 1); add("educator", 1); add("worldChanger", 1); }
        if (opt === "å¿ƒéˆå—å‚·çš„äºº") add("guide", 2);
        if (opt === "å­¦ç”Ÿ / å…’ç«¥") { add("educator", 2); add("guide", 1); }
        if (opt === "è¿½å¤¢çš„äºº") { add("leader", 1); add("adventurer", 1); }
        if (opt === "å®¶åº­ï¼æœ‹å‹") add("guide", 1);
        if (opt === "å‰µä½œè€…") add("creator", 2);
        if (opt === "ç¤¾å€æˆ–ç¤¾åœ˜") { add("leader", 1); add("worldChanger", 1); }
        if (opt === "ç§‘æŠ€èˆ‡ç¤¾æœƒä¹‹é–“çš„æ©‹æ¨‘") { add("innovator", 2); add("worldChanger", 1); }
        if (opt === "åœ°çƒèˆ‡ç’°å¢ƒ") { add("worldChanger", 2); }
      });

      // 6. ä¸–ç•Œç—›é»ï¼ˆpainsï¼‰
      (m.painVision.pains || []).forEach(opt => {
        if (opt === "å­¤å–®èˆ‡ç„¡åŠ›æ„Ÿ") { add("guide", 2); }
        if (opt === "æ•™è‚²ä¸å¹³ç­‰") { add("educator", 2); add("worldChanger", 1); }
        if (opt === "å¿ƒç†å¥åº·") { add("guide", 2); }
        if (opt === "é’å¹´è¿·å¤±ã€æ²’æœ‰æ–¹å‘") { add("guide", 1); add("educator", 1); }
        if (opt === "ç§‘æŠ€èˆ‡äººæ€§æ–·è£‚") { add("innovator", 2); add("worldChanger", 1); }
        if (opt === "é‡‘éŒ¢ç„¦æ…®èˆ‡ç¼ºä¹ç†è²¡çŸ¥è­˜") { add("educator", 1); add("organizer", 1); }
        if (opt === "ç’°å¢ƒè­°é¡Œ") { add("worldChanger", 2); }
        if (opt === "äººéš›è¡çª") { add("guide", 1); add("leader", 1); }
        if (opt === "è‡ªæˆ‘èªåŒå›°é›£") { add("guide", 2); }
        if (opt === "ç¤¾æœƒçš„ä¸å…¬") { add("worldChanger", 2); }
      });

      // 7. é¡˜æ™¯æ–¹å‘ï¼ˆvisionï¼‰
      const vision = m.painVision.vision || "";
      if (vision === "æˆç‚ºèƒ½é™ªä¼´èˆ‡ç™‚ç™’çš„äºº") add("guide", 3);
      if (vision === "æˆç‚ºæ¨å‹•çŸ¥è­˜èˆ‡æ•™è‚²çš„äºº") add("educator", 3);
      if (vision === "æˆç‚ºå‰µæ–°èˆ‡ç§‘æŠ€çš„æ©‹æ¨‘") add("innovator", 3);
      if (vision === "æˆç‚ºèƒ½å¸¶é ˜åœ˜éšŠçš„äºº") add("leader", 3);
      if (vision === "æˆç‚ºè‡ªç”±ã€æœ‰é¸æ“‡çš„äºº") add("adventurer", 3);
      if (vision === "æˆç‚ºå¿ƒéˆå¯Œè¶³çš„äºº") add("guide", 2);
      if (vision === "æˆç‚ºæ”¹è®Šä¸–ç•Œçš„äºº") add("worldChanger", 3);
      if (vision === "æˆç‚ºèƒ½å‰µé€ ç¾å¥½ä½œå“çš„äºº") add("creator", 3);

      // 8. äº®é»æ™‚åˆ»ï¼ˆbright momentsï¼‰ç°¡å–®é—œéµå­—åˆ¤è®€
      (m.bright.moments || []).forEach(text => {
        const t = (text || "").toLowerCase();
        if (!t) return;
        if (t.includes("æ•™") || t.includes("åˆ†äº«") || t.includes("è¬›") || t.includes("å¸¶è®€")) add("educator", 1);
        if (t.includes("å®‰æ…°") || t.includes("é™ª") || t.includes("è½") || t.includes("ç™‚ç™’")) add("guide", 1);
        if (t.includes("ä½œå“") || t.includes("ç•«") || t.includes("å¯«") || t.includes("å½±ç‰‡") || t.includes("éŸ³æ¨‚")) add("creator", 1);
        if (t.includes("å¸¶éšŠ") || t.includes("éšŠé•·") || t.includes("è² è²¬")) add("leader", 1);
        if (t.includes("å°ˆæ¡ˆ") || t.includes("ç³»çµ±") || t.includes("ç¨‹å¼")) add("innovator", 1);
        if (t.includes("è¦åŠƒ") || t.includes("æ•´ç†") || t.includes("æ¶æ§‹")) add("organizer", 1);
        if (t.includes("æŒ‘æˆ°") || t.includes("çªç ´")) add("adventurer", 1);
      });

      // å¹³æ»‘åŒ–è™•ç†ï¼šé¿å… M å‹æ¥µç«¯ï¼Œè®“éé›¶åˆ†æ•¸è½åœ¨ 2~5 ä¹‹é–“
      let maxRaw = 0;
      traitCategories.forEach(c => {
        if (scores[c.id] > maxRaw) maxRaw = scores[c.id];
      });
      if (maxRaw === 0) {
        return scores; // å…¨é›¶å°±ç¶­æŒ 0
      }

      const normalized = {};
      traitCategories.forEach(c => {
        const raw = scores[c.id];
        if (raw <= 0) {
          normalized[c.id] = 0;
        } else {
          const ratio = raw / maxRaw;   // 0~1
          normalized[c.id] = 2 + Math.round(3 * ratio); // 2~5 çš„æ•´æ•¸
        }
      });

      return normalized;
    }

	// æ ¹æ“šç‰¹è³ªåˆ†æ•¸ç”¢ç”Ÿç¨±è™Ÿèˆ‡ä¸€å¥æè¿°
function getArchetype(scores) {
  // 1. è½‰æˆé™£åˆ—ä¸¦æ’åº
  const scoreList = traitCategories.map(c => ({
    id: c.id,
    name: c.name,
    score: scores[c.id] || 0
  })).sort((a, b) => b.score - a.score);

  // éæ¿¾æ‰ 0 åˆ†
  const nonZero = scoreList.filter(x => x.score > 0);
  if (nonZero.length === 0) {
    return {
      title: "æ½›åŠ›å¾…å•Ÿå‹•çš„æ˜Ÿè¾°æ—…äºº",
      subtitle: "ä½ çš„ç‰¹è³ªåˆ†å¸ƒé‚„å¾ˆå¹³å‡ï¼Œä»£è¡¨ä½ æœ‰å¾ˆå¤šæ–¹å‘éƒ½é‚„åœ¨èŒèŠ½éšæ®µã€‚",
      detail: "é€™ä¸æ˜¯ã€æ²’æœ‰ç‰¹é•·ã€ï¼Œè€Œæ˜¯ä½ é‚„åœ¨è©¦è‘—é«”é©—å„ç¨®è§’è‰²ã€‚å¤šå»è©¦ã€å¤šå»ç¢°æ’ï¼Œä½ æœƒæ…¢æ…¢çœ‹è¦‹å“ªä¸€å¡Šç‰¹åˆ¥äº®ã€‚"
    };
  }

  // 2. å–å‰ 3 åï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
  const top1 = nonZero[0];
  const top2 = nonZero[1] || null;
  const top3 = nonZero[2] || null;

  const t1 = traitMeta[top1.id];
  const t2 = top2 ? traitMeta[top2.id] : null;
  const t3 = top3 ? traitMeta[top3.id] : null;

  // åˆ¤æ–·åˆ†æ•¸å·®è·ï¼ˆç”¨ä¾†åˆ¤æ–·æ˜¯å–®æ ¸å¿ƒã€é›™æ ¸å¿ƒé‚„æ˜¯ä¸‰æ ¸å¿ƒï¼‰
  const diff12 = top2 ? (top1.score - top2.score) : Number.POSITIVE_INFINITY;
  const diff23 = top3 ? (top2.score - top3.score) : Number.POSITIVE_INFINITY;

  let title = "";
  let subtitle = "";
  let detail = "";

  // åªæœ‰æ˜é¡¯ä¸€å€‹é«˜åˆ† â†’ å–®æ ¸å‹
  if (!top2 || diff12 >= 2) {
    title = `${t1.shortAdj}å‹${t1.roleNoun}`;
    subtitle = `ä½ æ˜¯åå‘ã€Œ${t1.name}ã€ç‰¹è³ªçš„éˆé­‚ã€‚`;
    detail = t1.tagline;
  }
  // å‰å…©åæ¥è¿‘ï¼Œç¬¬ä¸‰åè¼ƒä½ â†’ é›™æ ¸å¿ƒå‹
  else if (!top3 || (diff12 <= 1 && diff23 >= 2)) {
    title = `${t1.shortAdj}Ã—${t2.shortAdj}å‹${t2.roleNoun}`;
    subtitle = `ä½ çš„éˆé­‚åŒæ™‚ç«™åœ¨ã€Œ${t1.name}ã€èˆ‡ã€Œ${t2.name}ã€å…©å€‹è»¸å¿ƒä¸Šã€‚`;
    detail =
      `${t1.tagline} åŒæ™‚ï¼Œä½ ä¹Ÿå…·å‚™ ${t2.name} çš„æ°£è³ªï¼š${t2.tagline}`;
  }
  // ä¸‰å€‹éƒ½è »æ¥è¿‘ â†’ ä¸‰æ ¸å¿ƒå‹
  else {
    title = `${t1.shortAdj}Ã—${t2.shortAdj}Ã—${t3.shortAdj}å‹${t1.roleNoun}`;
    subtitle =
      `ä½ åœ¨ã€Œ${t1.name}ã€ã€ã€Œ${t2.name}ã€ã€ã€Œ${t3.name}ã€ä¸‰å€‹é¢å‘éƒ½æœ‰å¾ˆæ˜é¡¯çš„èƒ½é‡ã€‚`;
    detail =
      `${t1.tagline} å†åŠ ä¸Š ${t2.name} çš„éƒ¨åˆ†ï¼š${t2.tagline}ï¼Œä»¥åŠ ${t3.name} çš„è£œå¼·ï¼š${t3.tagline}ã€‚æ•´é«”çœ‹èµ·ä¾†ï¼Œä½ æ˜¯å¤šæ ¸å¿ƒçš„ç«‹é«”å‹éˆé­‚ã€‚`;
  }

  return { title, subtitle, detail, top1, top2, top3 };
}


    function drawRadar(scores) {
      const canvas = $("radar-canvas");
      if (!canvas || !canvas.getContext) return;
      const ctx = canvas.getContext("2d");
      const w = canvas.width;
      const h = canvas.height;
      ctx.clearRect(0, 0, w, h);

      const cx = w / 2;
      const cy = h / 2 + 10;
      const maxRadius = Math.min(w, h) * 0.35;

      const cats = traitCategories;
      const n = cats.length;

      let maxScore = 0;
      cats.forEach(c => {
        if (scores[c.id] > maxScore) maxScore = scores[c.id];
      });
      if (maxScore === 0) maxScore = 1;

      ctx.strokeStyle = "rgba(255,255,255,0.2)";
      ctx.lineWidth = 1;
      const levels = 4;
      for (let L = 1; L <= levels; L++) {
        const r = maxRadius * (L / levels);
        ctx.beginPath();
        for (let i = 0; i < n; i++) {
          const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
          const x = cx + Math.cos(angle) * r;
          const y = cy + Math.sin(angle) * r;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.stroke();
      }

      ctx.font = "11px 'Noto Sans TC'";
      ctx.fillStyle = "rgba(248,244,255,0.85)";
      cats.forEach((cat, i) => {
        const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
        const x = cx + Math.cos(angle) * maxRadius;
        const y = cy + Math.sin(angle) * maxRadius;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(x, y);
        ctx.strokeStyle = "rgba(255,255,255,0.18)";
        ctx.stroke();

        const labelX = cx + Math.cos(angle) * (maxRadius + 18);
        const labelY = cy + Math.sin(angle) * (maxRadius + 18);
        ctx.textAlign = labelX >= cx ? "left" : "right";
        ctx.textBaseline = "middle";
        ctx.fillText(cat.name, labelX, labelY);
      });

      ctx.beginPath();
      cats.forEach((cat, i) => {
        const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
        const ratio = scores[cat.id] / maxScore;
        const r = maxRadius * ratio;
        const x = cx + Math.cos(angle) * r;
        const y = cy + Math.sin(angle) * r;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.closePath();
      ctx.fillStyle = "rgba(245,206,106,0.28)";
      ctx.fill();
      ctx.strokeStyle = "rgba(245,206,106,0.9)";
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    function handleJourneyEnd() {
      showScreen("summary-screen");
      buildSummary();
    }

    function buildSummary() {
      const name = state.player.name || "æ—…äºº";
      const gender = state.player.gender || "æœªå¡«å¯«";
      $("summary-intro").textContent =
        `ç»çµ¦ï¼š${name}ï½œæ€§åˆ¥ï¼š${gender}ï½œé€™ä¸€è¼ªæ—…ç¨‹çš„æ¯ä¸€å€‹é¸æ“‡ï¼Œéƒ½æˆç‚ºé€™ä»½å ±å‘Šæ›¸çš„å­—å¥ã€‚`;

      const gainedUnique = uniqueArray(state.journey.gained);
      const lostUnique = uniqueArray(state.journey.lost);

      const gainedDiv = $("summary-gained");
      const lostDiv = $("summary-lost");
      gainedDiv.innerHTML = "";
      lostDiv.innerHTML = "";

      if (gainedUnique.length === 0) {
        const span = document.createElement("span");
        span.textContent = "é€™æ¬¡çš„æ—…ç¨‹è£¡ï¼Œä½ çš„ç²å¾—æ¯”è¼ƒå…§æ–‚ï¼Œéœ€è¦ä½ è‡ªå·±æ…¢æ…¢å›å‘³ã€‚";
        gainedDiv.appendChild(span);
      } else {
        gainedUnique.forEach(g => {
          const span = document.createElement("span");
          span.textContent = g;
          gainedDiv.appendChild(span);
        });
      }

      if (lostUnique.length === 0) {
        const span = document.createElement("span");
        span.textContent = "é€™æ¬¡çš„æ—…ç¨‹ä¸­ï¼Œæ²’æœ‰è¢«ä½ æ˜ç¢ºæ¨™è¨˜ç‚ºå¤±å»çš„äº‹ç‰©ã€‚";
        lostDiv.appendChild(span);
      } else {
        lostUnique.forEach(l => {
          const span = document.createElement("span");
          span.textContent = l;
          lostDiv.appendChild(span);
        });
      }

      const coreDiv = $("summary-core-values");
      coreDiv.innerHTML = "";
      const baseValues = uniqueArray(state.selections.values);
      if (baseValues.length > 0) {
        baseValues.forEach(v => {
          const span = document.createElement("span");
          span.textContent = v;
          coreDiv.appendChild(span);
        });
      }

      const energySel = state.missions.energy.selected || [];
      if (energySel.length > 0) {
        const span = document.createElement("span");
        span.textContent = `ä½ æœƒå¾ã€Œ${energySel.join("ã€")}ã€é€™äº›äº‹æƒ…ä¸­ç²å¾—èƒ½é‡ã€‚`;
        coreDiv.appendChild(span);
      }

      if (state.missions.painVision.pains && state.missions.painVision.pains.length > 0) {
        const span = document.createElement("span");
        span.textContent = `ä½ å°ã€Œ${state.missions.painVision.pains.join("ã€")}ã€é€™é¡è­°é¡Œç‰¹åˆ¥æœ‰æ„Ÿã€‚`;
        coreDiv.appendChild(span);
      }

      if (state.reflections[0] && state.reflections[0].trim()) {
        const span = document.createElement("span");
        span.textContent = `ä½ åœ¨æ—…ç¨‹ä¸­å¯«ä¸‹çš„åƒ¹å€¼æé†’ï¼š${state.reflections[0].trim()}`;
        coreDiv.appendChild(span);
      }

      if (coreDiv.children.length === 0) {
        const span = document.createElement("span");
        span.textContent = "ä½ é‚„æ²’æœ‰æ˜ç¢ºå¯«ä¸‹è‡ªå·±çš„åƒ¹å€¼ï¼Œä½†æ²’é—œä¿‚ï¼Œé€™åªæ˜¯èµ·é»ã€‚";
        coreDiv.appendChild(span);
      }

      const visionDiv = $("summary-vision");
      visionDiv.innerHTML = "";
      const pv = state.missions.painVision;
      let visionText = pv.vision || pv.visionOther || "";
      if (visionText.trim()) {
        const span = document.createElement("span");
        span.textContent = visionText;
        visionDiv.appendChild(span);
      } else {
        const span = document.createElement("span");
        span.textContent = "é€™æ¬¡ä½ é‚„æ²’æœ‰ç‚ºè‡ªå·±å–ä¸€å€‹é¡˜æ™¯èº«ä»½ï¼Œä¸‹æ¬¡æ—…ç¨‹å¯ä»¥è©¦è©¦çœ‹ã€‚";
        visionDiv.appendChild(span);
      }

      const seizeDiv = $("summary-seize");
      seizeDiv.innerHTML = "";
      const toSeize = pickLastUnique(state.journey.gained, 3);
      if (toSeize.length === 0) {
        const span = document.createElement("span");
        span.textContent = "ä½ å¯ä»¥å›é ­çœ‹çœ‹ï¼šå“ªå¹¾ä»¶äº‹è®“ä½ ç‰¹åˆ¥æœ‰æ„Ÿï¼Ÿé‚£å¾€å¾€å°±æ˜¯ä½ ç¾åœ¨è©²æŠŠæ¡çš„ç·šç´¢ã€‚";
        seizeDiv.appendChild(span);
      } else {
        toSeize.forEach(s => {
          const span = document.createElement("span");
          span.textContent = s;
          seizeDiv.appendChild(span);
        });
      }

      $("summary-ref1").textContent =
        state.reflections[0] || "ï¼ˆé€™æ¬¡ä½ æ²’æœ‰å¯«ä¸‹ï¼Œä½†ä½ å¯ä»¥åœ¨å¿ƒè£¡é»˜é»˜å›ç­”ã€‚ï¼‰";
      $("summary-ref2").textContent =
        state.reflections[1] || "ï¼ˆä½ æœ€æƒ³ç…§äº®çš„æ˜¯èª°ï¼Ÿä¹Ÿè¨±ä½ çš„å¿ƒè£¡å…¶å¯¦æ—©å°±æœ‰ç­”æ¡ˆã€‚ï¼‰";
      $("summary-ref3").textContent =
        state.reflections[2] || "ï¼ˆã€Œæˆ‘å­˜åœ¨ï¼Œæ˜¯ç‚ºäº†â€¦â€¦ã€é€™å¥è©±ï¼Œå¯ä»¥æ…¢æ…¢é•·å¤§ï¼Œä¸æ€¥è‘—ä¸€æ¬¡èªªå®Œã€‚ï¼‰";

      const logDiv = $("summary-log");
      logDiv.innerHTML = "";
      state.journey.log.forEach(entry => {
        const p = document.createElement("p");
        p.textContent = entry;
        logDiv.appendChild(p);
      });

      const scores = computeTraitScores();
      drawRadar(scores);

const archetype = getArchetype(scores);

// é¡¯ç¤ºç¨±è™Ÿ
const archTitleDiv = $("summary-archetype-title");
const archSubtitleP = $("summary-archetype-subtitle");
const archDetailP = $("summary-archetype-detail");

archTitleDiv.innerHTML = "";
const titleSpan = document.createElement("span");
titleSpan.textContent = archetype.title;
archTitleDiv.appendChild(titleSpan);

archSubtitleP.textContent = archetype.subtitle;
archDetailP.textContent = archetype.detail;


      const strengthsDiv = $("summary-strengths");
      strengthsDiv.innerHTML = "";
      const strengthList = traitCategories
        .map(c => ({ id: c.id, name: c.name, desc: c.desc, score: scores[c.id] || 0 }))
        .filter(x => x.score > 0)
        .sort((a, b) => b.score - a.score)
        .slice(0, 3);

      if (strengthList.length === 0) {
        const span = document.createElement("span");
        span.textContent = "é€™ä¸€è¼ªçš„é¸æ“‡é‚„çœ‹ä¸å‡ºæ˜é¡¯çš„ç‰¹è³ªèµ°å‘ï¼Œä½†ä½ æœ¬èº«å°±æ˜¯ä¸€é¡†é‚„åœ¨æˆå½¢çš„æ˜Ÿæ˜Ÿã€‚";
        strengthsDiv.appendChild(span);
      } else {
        strengthList.forEach(s => {
          const span = document.createElement("span");
          span.textContent = `ã€${s.name}ã€‘${s.desc}`;
          strengthsDiv.appendChild(span);
        });
      }
    }

    // =============================
    // Event Bindings
    // =============================
    function init() {
      renderCheckboxGroup("abilities-group", abilitiesOptions, "abilities");
      renderCheckboxGroup("values-group", valueOptions, "values");
      renderCheckboxGroup("companions-group", companionOptions, "companions");

      document.addEventListener("change", (e) => {
        if (["abilities", "values", "companions"].includes(e.target.name)) {
          updateCounters();
        }
      });

      $("btn-start").addEventListener("click", () => {
        const name = $("player-name").value.trim();
        const genderRadio = document.querySelector("input[name='gender']:checked");
        const gender = genderRadio ? genderRadio.value : "";
        const decl = $("declaration").value.trim();

        state.player.name = name || "æ—…äºº";
        state.player.gender = gender || "æœªå¡«å¯«";
        state.player.declaration = decl;

        showScreen("setup-screen");
      });

      $("btn-back-start").addEventListener("click", () => {
        showScreen("start-screen");
      });

      $("btn-begin-journey").addEventListener("click", () => {
        const abilities = getCheckedValues("abilities");
        const values = getCheckedValues("values");
        const companions = getCheckedValues("companions");

        if (abilities.length !== 3 || values.length !== 3 || companions.length !== 3) {
          alert("è«‹ç¢ºå®šä¸‰å€‹å€å¡Šéƒ½å„é¸æ“‡ã€Œä¸‰é …ã€å†å‡ºç™¼å–”ã€‚");
          return;
        }

        state.selections.abilities = abilities;
        state.selections.values = values;
        state.selections.companions = companions;

        $("mini-log").innerHTML = "";
        appendLog(`å‡ºç™¼å‰ï¼Œä½ é¸æ“‡çš„èƒ½åŠ›æ˜¯ï¼š${abilities.join("ã€")}ã€‚`);
        appendLog(`ä½ ç›®å‰æ¯”è¼ƒèªåŒçš„è§€å¿µæ˜¯ï¼š${values.join("ã€")}ã€‚`);
        appendLog(`åœ¨ä½ å¿ƒè£¡çš„é‡è¦å¤¥ä¼´æœ‰ï¼š${companions.join("ã€")}ã€‚`);

        state.journey.currentIndex = 0;
        state.missionQueue = shuffle(missionBlocks);
        showScreen("journey-screen");
        renderScenario();
      });

      $("btn-reflection-continue").addEventListener("click", () => {
        finishReflection();
      });

      $("btn-mission-continue").addEventListener("click", () => {
        saveCurrentMission();
        state.currentMission = null;
        showScreen("journey-screen");
        renderScenario();
      });

      $("btn-restart").addEventListener("click", () => {
        stopTimer();
        resetState();
        showScreen("start-screen");
      });

      $("btn-toggle-reflections").addEventListener("click", () => {
        const panel = $("detail-reflections");
        panel.style.display = panel.style.display === "none" ? "block" : "none";
      });

      $("btn-toggle-log").addEventListener("click", () => {
        const panel = $("detail-log");
        panel.style.display = panel.style.display === "none" ? "block" : "none";
      });

      $("card-close").addEventListener("click", () => {
        closeCardModal();
      });
    }

    init();
  </script>
</body>
</html>
